<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Profile ‚Äì Palette and Fit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

<style>
  /* make sure every text uses the same font as SIGNUP1 */
html, body {
  font-family: 'Poppins', sans-serif;
}

input,
select,
button,
textarea {
  font-family: 'Poppins', sans-serif;
}

:root {
  --bg-light: #f6f3fc;
  --accent: #ad00e2;
  --accent-glow: #e8d8fd;
  --card-bg: #ffffff;
  --text: #20144a;
  --input-border: #d4c4ef;
  --input-bg: #faf6fe;
  --shadow: 0 8px 36px #ad00e222, 0 1.5px 8px #ad00e208;
  --shadow-dark: 0 6px 32px #0003, 0 1.5px 8px #0002;
  --btn-purple: #ad00e2;
  --btn-purple-dark: #7a2df6;
  /* smaller pills ‚Äì similar to SIGNUP1 */
  --top-pill-width: 120px;

  /* your full base64 bg here */
  --custom-bg: url('data:image/jpeg;base64,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');
}

/* ---------- GLOBAL LAYOUT (NO SIDE SCROLL) ---------- */
body.dark-mode {
  color: #fff;
  --input-bg: rgba(24, 14, 45, 0.85);
  --card-bg: rgba(18, 9, 34, 0.96);
  --text: #e7d6fa;
  --input-border: #9f7de0;
  --btn-purple: #ad00e2;
  --btn-purple-dark: #7a2df6;
}

html, body {
  height: 100%;
  max-width: 100%;
  overflow-x: hidden;   /* stop left/right scroll */
}

body {
  margin: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
  color: var(--text);
  min-height: 100vh;
  padding: clamp(1.5rem, 4vh, 3rem) clamp(0.8rem, 4vw, 1.8rem);
  background: none;
  transition: background 0.3s, color 0.3s;
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: var(--custom-bg) center center/cover no-repeat fixed;
  z-index: -2;
  filter: brightness(1) contrast(1.02) saturate(1.1);
  transition: filter 0.3s;
}
body.dark-mode::before {
  filter: brightness(0.66) contrast(1.08) saturate(1.15);
}

/* ---------- CARD / FORM ---------- */
.container {
  width: 100%;
  max-width: 640px;
  margin: 0 auto;
  background: var(--card-bg);
  border-radius: 2.2rem;
  box-shadow: var(--shadow);
  backdrop-filter: blur(12px);
  padding: 1.35rem 2.4rem 1.6rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  box-sizing: border-box;
}
body.dark-mode .container {
  background: rgba(20,11,39,0.94);
  box-shadow: var(--shadow-dark);
}

/* ---------- TOP BAR (BACK + DARK MODE) ---------- */
.top-bar {
  width: 100%;
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  margin-bottom: 0.7rem;
}

.pill-btn {
  min-width: var(--top-pill-width);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 0.35rem 0.9rem;
  border-radius: 999px;
  border: none;
  font-size: 0.82rem;
  font-weight: 600;
  white-space: nowrap;
  box-shadow: 0 2px 12px #ad00e225;
  cursor: pointer;
  text-decoration: none;
  text-align: center;
  transition: background 0.18s, color 0.18s,
              box-shadow 0.18s, transform 0.12s;
}

/* light mode pills: purple */
body:not(.dark-mode) .pill-btn {
  background: var(--accent);
  color: #ffffff;
}
/* dark mode pills: white */
body.dark-mode .pill-btn {
  background: #ffffff;
  color: var(--accent);
}

.pill-btn:hover,
.pill-btn:focus-visible {
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(173, 0, 226, 0.32);
}
body:not(.dark-mode) .pill-btn:hover,
body:not(.dark-mode) .pill-btn:focus-visible {
  background: var(--btn-purple-dark);
  color: #ffffff;
}
body.dark-mode .pill-btn:hover,
body.dark-mode .pill-btn:focus-visible {
  background: #f7f1ff;
  color: #7a2df6;
}

.back-home::before { content: "‚Üê"; font-size: 0.9rem; }
.dark-toggle { border: none; }

/* ---------- STEPPER / HEADINGS ---------- */
.progress-bar {
  display: flex;
  justify-content: center;
  align-items: flex-end;
  margin-bottom: 0.45rem;
  gap: 2.2rem;
  width: 100%;
  margin-top: 0.3rem;
}
.step {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 1.04rem;
  font-weight: 600;
  color: #b3a5c7;
  gap: 0.2rem;
  transition: color 0.18s;
}
.step.active {
  color: var(--accent);
  font-weight: 900;
}
.step-circle {
  width: 36px; height: 36px;
  border-radius: 50%;
  background: #f5eaff;
  color: var(--accent);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 1.2rem;
  margin-bottom: 0.15rem;
  border: 2.5px solid #e8d8fd;
  box-shadow: 0 2px 10px #ad00e21c;
}
.step.active .step-circle {
  background: var(--accent);
  color: #fff;
  border: 2.5px solid var(--accent);
  box-shadow: 0 4px 16px #ad00e246;
}
body.dark-mode .step-circle {
  background: #3b1853;
  color: var(--accent);
  border: 2.5px solid var(--accent);
}
body.dark-mode .step.active .step-circle {
  background: var(--accent);
  color: #fff;
  border: 2.5px solid #fff;
}

.tagline {
  margin-top: 0.2rem;
  font-size: 0.92rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: #7b57c4;
  text-align: center;
}
body.dark-mode .tagline { color: #d3c0ff; }

h2 {
  margin-bottom: 1rem;
  margin-top: 0.3rem;
  color: var(--accent);
  text-align: center;
  font-weight: 800;
  font-size: 2.05rem;
  letter-spacing: 0.3px;
  text-shadow: 0 1px 8px #e8d8fd;
}
body.dark-mode h2 { color: #fff; text-shadow: 0 1px 12px #7a2df6; }

/* ---------- FORM ---------- */
form {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 0.7rem;
  margin-top: 0.1rem;
}

label {
  font-size: 1.01rem;
  font-weight: 600;
  margin-bottom: 0.07rem;
  color: #7054ad;
  margin-left: 2px;
}
body.dark-mode label { color: #cbbcf3; }

/* text / number / select ‚Äì DO NOT touch range here */
input:not([type="range"]),
select {
  width: 100%;
  padding: 0.48rem 1.1rem;
  border-radius: 1.2rem;
  border: 1.5px solid var(--input-border);
  background: var(--input-bg);
  font-size: 1.06rem;
  color: var(--text);
  outline: none;
  margin-top: 0.07rem;
  box-shadow: 0 0.5px 3px #b292d11c;
  transition: border-color 0.18s, box-shadow 0.19s, background 0.18s;
  height: 2.3rem;
  font-weight: 600;
  -webkit-appearance: none;
  appearance: none;
  box-sizing: border-box;
}

input:not([type="range"]):focus,
select:focus {
  border-color: var(--accent);
  background: #f7f0fd;
  box-shadow: 0 2px 12px #c6a1e817;
}
body.dark-mode input:not([type="range"]),
body.dark-mode select {
  color: #ffffff;
  background: rgba(21, 12, 43, 0.95);
  border-color: #845acb;
}

/* ---------- SKIN TONE SLIDER ---------- */
.skin-tone-row {
  display: flex;
  align-items: center;
  gap: 1.2rem;
  margin-bottom: 0.4rem;
  margin-top: 0.2rem;
  flex-wrap: wrap;
}
.skin-preview {
  width: 34px; height: 34px;
  border-radius: 50%;
  border: 2px solid var(--accent);
  box-shadow: 0 2px 8px #ebd8ff;
  background: #fff;
}
input[type="range"].skin-slider {
  -webkit-appearance: none;
  width: 150px; height: 7px;
  border-radius: 5px;
  background: #ddd; /* JS replaces with gradient */
  outline: none;
  margin: 0 5px;
}
input[type="range"].skin-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--accent);
  box-shadow: 0 1px 4px #bba8f8;
  border: 2px solid #fff;
  cursor: pointer;
}
input[type="range"].skin-slider::-moz-range-thumb {
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--accent);
  border: 2px solid #fff;
  cursor: pointer;
}

.tone-name-fixed{
  display:inline-block;
  width:140px;
  min-width:140px;
  margin-left:12px;
  font-weight:600;
  color:#ad00e2;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* ---------- BUTTONS ---------- */
.camera-btn,
.btn,
.use-tone-btn {
  background: var(--btn-purple);
  color: #fff;
  font-weight: 700;
  font-size: 1.02rem;
  border: none;
  border-radius: 1rem;
  cursor: pointer;
  transition: background 0.19s, box-shadow 0.18s, transform 0.13s, color 0.18s;
  box-shadow: 0 2.2px 14px #ad00e222;
}
.btn {
  margin-top: 0.17rem;
  padding: 0.71rem 0;
  width: 100%;
  letter-spacing: 0.12px;
}
.camera-btn {
  border-radius: 0.7rem;
  padding: 0.35rem 0.9rem;
  font-size: 0.97rem;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
.btn:hover,
.camera-btn:hover,
.use-tone-btn:hover {
  background: var(--btn-purple-dark);
  transform: translateY(-1px) scale(1.01);
}

/* ---------- FOOTER TEXT ---------- */
.bottom-links {
  margin-top: 0.65rem;
  font-size: 0.93rem;
  text-align: center;
  color: #7a5ab3;
}
.bottom-links a {
  color: var(--accent);
  text-decoration: none;
  font-weight: 600;
  margin-left: 0.3rem;
}
.bottom-links a:hover { text-decoration: underline; }
body.dark-mode .bottom-links { color: #d6c7ff; }

#profileMsg {
  text-align:center;
  color:#ad00e2;
  font-weight:600;
  margin-top:8px;
  min-height:1.1rem;
}

/* ---------- CAMERA MODAL (DESKTOP) ---------- */
#cameraModal {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 1111;
  background: rgba(20,15,27,0.96);
  align-items: center;
  justify-content: center;
  padding: 1rem;
  box-sizing: border-box;
  overflow-y: auto;
}
#cameraModal .modal-row {
  display: flex;
  flex-direction: row;
  width: 100%;
  max-width: 900px;
  background: #fff;
  border-radius: 1.8rem;
  box-shadow: 0 8px 32px #0003;
  overflow: hidden;
  box-sizing: border-box;
}
#cameraModal .camera-col,
#cameraModal .result-col {
  flex: 1 1 0;
  min-width: 0;
}

#cameraModal .camera-col {
  background:#130d20;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:1.25rem 1rem 1.4rem;
}
.camera-box-wrap {
  width: 100%;
  max-width: 340px;
  max-height: 65vh;
  aspect-ratio: 3/4;
  position: relative;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius: 1.6rem;
  overflow:hidden;
}
#modalVideo, #cameraCanvas, #bigGuideCircle {
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}
/* un-mirror selfie effect */
/* #modalVideo {
  transform: scaleX(-1);
} */
#bigGuideCircle {
  border: 5px solid #ad00e2;
  border-radius:50%;
  box-shadow:0 0 0 8px #ad00e233;
  pointer-events:none;
}
.camera-warning-under {
  width:100%;
  max-width:340px;
  margin-top:0.9rem;
  background:#24123f;
  color:#ffd400;
  border-radius:1.1rem;
  box-shadow:0 2px 18px #20144a27;
  font-size:0.95rem;
  font-weight:600;
  padding:11px 14px 9px;
  border:1.2px solid #ffd40038;
  text-align:center;
}
#sampleSkinToneBtn {
  margin-top:0.9rem;
  padding:0.75rem 1.9rem;
  border-radius:1.1rem;
  border:none;
  cursor:pointer;
  background:linear-gradient(90deg,#ad00e2 80%,#bd7ffe 100%);
  color:#fff;
  font-weight:700;
  box-shadow:0 2px 16px #ad00e236;
  letter-spacing:0.03em;
}
#sampleSkinToneBtn:hover {
  background:linear-gradient(90deg,#bd7ffe 10%,#ad00e2 90%);
}

#closeCameraBtn {
  position:absolute;
  right:1.2rem;
  top:1rem;
  font-size:2.1rem;
  background:none;
  border:none;
  color:#fff;
  cursor:pointer;
  z-index:20;
}

#cameraModal .result-col {
  background:linear-gradient(120deg,#f6f3fc 65%,#f2edff 100%);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:1.8rem 1.3rem 1.9rem;
  overflow-y:auto;
}
#cameraModal .detected-msg {
  color:#20144a;
  font-size:1.05rem;
  font-weight:700;
  margin-bottom:0.7rem;
  margin-top:0.6rem;
  text-align:center;
}
#cameraModal .tone-preview-big {
  margin:1.0rem 0 0.6rem;
  width:60px;height:60px;
  border-radius:50%;
  border:4px solid #ad00e2;
  box-shadow:0 4px 18px #ad00e233;
}
#cameraModal .tone-name {
  font-size:1.05rem;
  font-weight:700;
  color:#ad00e2;
  margin-bottom:1.2rem;
  text-align:center;
}
.use-tone-btn {
  padding:0.8rem 2.3rem;
  margin-top:0.5rem;
}
.use-tone-btn:disabled {
  background:#d1a67d;
  cursor:not-allowed;
  opacity:0.8;
}

/* ---------- RESPONSIVE BREAKPOINTS ---------- */
@media (max-width: 900px) {
  .container {
    padding: 1.2rem 1.5rem 1.5rem;
    border-radius: 1.9rem;
  }
}

@media (max-width: 600px) {
  :root { --top-pill-width: 115px; }

  body {
    padding: 1.8rem 0.7rem 1.4rem;
  }

  .container {
    padding: 1rem 0.9rem 1.2rem;
    border-radius: 1.6rem;
  }

  .progress-bar { gap: 1.4rem; }
  h2 { font-size: 1.6rem; }
  .step-circle { width: 28px; height: 28px; font-size: 1rem; }

  /* modal stacks ‚Äì camera on top, result below, fully visible */
  #cameraModal {
    align-items: flex-start;
  }
  #cameraModal .modal-row {
    flex-direction: column;
    max-width: 360px;
    width: 100%;
    margin: 1rem auto;
  }
  #cameraModal .camera-col,
  #cameraModal .result-col {
    width: 100%;
  }
  .camera-box-wrap,
  .camera-warning-under {
    max-width: 100%;
  }
  #cameraModal .result-col {
    padding: 1.3rem 1rem 1.5rem;
  }
}

@media (max-width: 400px) {
  body { padding-inline: 0.5rem; }
  .container { padding-inline: 0.7rem; border-radius: 1.4rem; }

  .top-bar {
    flex-direction: column;
    align-items: stretch;
  }
  .pill-btn {
    width: 100%;
    justify-content: center;
  }

  h2 { font-size: 1.35rem; }
  .tagline { font-size: 0.84rem; }
  label, .step { font-size: 0.86rem; }

  input:not([type="range"]),
  select {
    font-size: 0.9rem;
    height: 2.1rem;
  }

  .btn, .camera-btn { font-size: 0.95rem; }
  .skin-preview { width: 28px; height: 28px; }
  .skin-tone-row { gap: 0.7rem; }
}

/* ================= CAMERA MODAL (SECOND BLOCK ‚Äì keep layout consistent) =================== */

#cameraModal {
  display: none;                    /* JS will set to flex */
  position: fixed;
  inset: 0;
  z-index: 1111;
  background: rgba(20,15,27,0.96);
  justify-content: center;
  align-items: flex-start;          /* important: so tall content can scroll */
  padding: 1rem;
  box-sizing: border-box;
  overflow-y: auto;                 /* allows scrolling to see result section */
}

/* white panel inside the dark overlay */
#cameraModal .modal-row {
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  width: 100%;
  max-width: 900px;
  margin: 1.2rem auto;
  background: #ffffff;
  border-radius: 1.8rem;
  box-shadow: 0 8px 32px #0003;
  overflow: hidden;
  box-sizing: border-box;
}

/* left = camera, right = result */
#cameraModal .camera-col,
#cameraModal .result-col {
  flex: 1 1 0;
  min-width: 0;
}

/* --- camera side --- */

#cameraModal .camera-col {
  background:#130d20;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:1.25rem 1rem 1.4rem;
  box-sizing: border-box;
}

.camera-box-wrap {
  width: 100%;
  max-width: 340px;
  aspect-ratio: 3/4;
  max-height: 70vh;
  position: relative;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius: 1.6rem;
  overflow:hidden;
}

#modalVideo,
#cameraCanvas,
#bigGuideCircle {
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
}

/* re-apply un-mirror after second block */
#modalVideo {
  transform: scaleX(-1);
}

#bigGuideCircle {
  border: 5px solid #ad00e2;
  border-radius:50%;
  box-shadow:0 0 0 8px #ad00e233;
  pointer-events:none;
}

.camera-warning-under {
  width:100%;
  max-width:340px;
  margin-top:0.9rem;
  background:#24123f;
  color:#ffd400;
  border-radius:1.1rem;
  box-shadow:0 2px 18px #20144a27;
  font-size:0.95rem;
  font-weight:600;
  padding:11px 14px 9px;
  border:1.2px solid #ffd40038;
  text-align:center;
}

#sampleSkinToneBtn {
  margin-top:0.9rem;
  padding:0.75rem 1.9rem;
  border-radius:1.1rem;
  border:none;
  cursor:pointer;
  background:linear-gradient(90deg,#ad00e2 80%,#bd7ffe 100%);
  color:#fff;
  font-weight:700;
  box-shadow:0 2px 16px #ad00e236;
  letter-spacing:0.03em;
}

#sampleSkinToneBtn:hover {
  background:linear-gradient(90deg,#bd7ffe 10%,#ad00e2 90%);
}

/* close X */
#closeCameraBtn {
  position:absolute;
  right:1.2rem;
  top:1rem;
  font-size:2.1rem;
  background:none;
  border:none;
  color:#fff;
  cursor:pointer;
  z-index:20;
}

/* --- result side --- */

#cameraModal .result-col {
  background:linear-gradient(120deg,#f6f3fc 65%,#f2edff 100%);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:1.8rem 1.3rem 1.9rem;
  box-sizing: border-box;
}

#cameraModal .detected-msg {
  color:#20144a;
  font-size:1.05rem;
  font-weight:700;
  margin-bottom:0.7rem;
  margin-top:0.6rem;
  text-align:center;
}

#cameraModal .tone-preview-big {
  margin:1.0rem 0 0.6rem;
  width:60px;
  height:60px;
  border-radius:50%;
  border:4px solid #ad00e2;
  box-shadow:0 4px 18px #ad00e233;
}

#cameraModal .tone-name {
  font-size:1.05rem;
  font-weight:700;
  color:#ad00e2;
  margin-bottom:1.2rem;
  text-align:center;
}

.use-tone-btn {
  padding:0.8rem 2.3rem;
  margin-top:0.5rem;
}

.use-tone-btn:disabled {
  background:#d1a67d;
  cursor:not-allowed;
  opacity:0.8;
}

/* ============ RESPONSIVE ============ */

/* tablet + mobile */
@media (max-width: 768px) {
  #cameraModal {
    align-items:flex-start;      /* keep from vertically centering too tall box */
  }

  #cameraModal .modal-row {
    flex-direction:column;       /* stack camera + result */
    max-width: 380px;
    width: 100%;
    margin: 1.2rem auto;
  }

  #cameraModal .camera-col,
  #cameraModal .result-col {
    width:100%;
    flex:0 0 auto;
  }

  .camera-box-wrap {
    max-width:100%;
    max-height:60vh;
  }

  #cameraModal .result-col {
    padding:1.4rem 1rem 1.6rem;
  }
}

/* very small phones */
@media (max-width: 400px) {
  #cameraModal .modal-row {
    max-width: 340px;
    margin: 0.8rem auto;
  }

  #cameraModal .result-col {
    padding:1.2rem 0.8rem 1.4rem;
  }
}

/* -------- TOP BAR: Back (left) + Dark Mode (right) -------- */

.top-bar {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;   /* left + right */
  gap: 0.75rem;
  margin-bottom: 0.9rem;
}

/* Same pill for BOTH buttons (Back + Dark Mode) */
.pill-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 0.48rem 1.6rem;          /* height + width same as SIGNUP1 */
  border-radius: 999px;
  border: none;
  font-size: 0.9rem;
  font-weight: 600;
  white-space: nowrap;
  min-width: 150px;                 /* same width for both pills */
  box-shadow: 0 2px 12px #ad00e225;
  cursor: pointer;
  text-decoration: none;
  text-align: center;
  transition:
    background 0.18s,
    color 0.18s,
    box-shadow 0.18s,
    transform 0.12s;
}

/* Light mode pill colors */
body:not(.dark-mode) .pill-btn {
  background: var(--accent);
  color: #ffffff;
}

/* Dark mode pill colors */
body.dark-mode .pill-btn {
  background: #ffffff;
  color: var(--accent);
}

.pill-btn:hover,
.pill-btn:focus-visible {
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(173, 0, 226, 0.32);
}

body:not(.dark-mode) .pill-btn:hover,
body:not(.dark-mode) .pill-btn:focus-visible {
  background: var(--btn-purple-dark);
  color: #ffffff;
}

body.dark-mode .pill-btn:hover,
body.dark-mode .pill-btn:focus-visible {
  background: #f7f1ff;
  color: #7a2df6;
}

/* icon for Back */
.back-home::before {
  content: "‚Üê";
  font-size: 0.93rem;
}

/* Dark toggle uses the same pill styling */
.dark-toggle {
  border: none;
}

/* -------- OVERRIDE OLD MOBILE RULES -------- */

@media (max-width: 400px) {
  .top-bar {
    flex-direction: row;            /* force row again */
    align-items: center;
    justify-content: space-between;
  }

  .pill-btn {
    width: auto;                    /* cancel width:100% from old CSS */
    min-width: 140px;
  }
}

/* FIX: don't mirror the camera */
#modalVideo {
  transform: none !important;
}

/* Selfie-style: move right = screen pe bhi right */
#modalVideo {
  transform: scaleX(-1) !important;
}
/* FIX: mirror the camera so right = right */
#modalVideo {
  transform: scaleX(-1) !important;
}
</style>

</head>

<body>
  <div class="container">
    <div class="top-bar">
      <a href="SIGNUP1.html" class="pill-btn back-home">Back</a>
      <button class="pill-btn dark-toggle" id="toggleDark">üåô Dark Mode</button>
    </div>

    <div class="progress-bar">
      <div class="step"><div class="step-circle">1</div>Account</div>
      <div class="step active"><div class="step-circle">2</div>Profile</div>
      <div class="step"><div class="step-circle">3</div>Welcome</div>
    </div>

    <p class="tagline">LET‚ÄôS SIGN UP TO PALETTE AND FIT</p>
    <h2>Create Account</h2>

    <form id="profileForm" autocomplete="off">
      <div>
        <label for="name">Full Name</label>
        <input type="text" id="name" maxlength="36" placeholder="Full name" required>
      </div>

      <div>
        <label for="gender">Gender</label>
        <select id="gender" required>
          <option value="" disabled selected>Select Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div>
        <label>Skin Tone <span style="font-size:0.99rem;font-weight:400;color:#888;">(or use Detect with Camera)</span></label>
        <div class="skin-tone-row">
          <span class="skin-preview" id="skinPreview"></span>
          <input type="range" min="0" max="100" value="30" class="skin-slider" id="skinSlider" required>
          <button type="button" class="camera-btn" id="openCameraBtn">
            <svg width="18" height="18" style="vertical-align:-3px;margin-right:3px" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="2" y="5" width="14" height="10" rx="2.5" stroke="#fff" stroke-width="2" fill="none"/>
              <circle cx="9" cy="10" r="2.5" stroke="#fff" stroke-width="2" fill="none"/>
              <rect x="7" y="3" width="4" height="2" rx="1" fill="#fff"/>
            </svg>
            Detect with Camera
          </button>
        </div>
        <input type="hidden" id="skinToneColor" required>
      </div>

      <div>
        <label for="age">Age</label>
        <input type="number" min="10" max="100" id="age" placeholder="Enter your age" required>
      </div>

      <button class="btn" type="submit">Continue</button>
    </form>

    <div id="profileMsg"></div>

    <div class="bottom-links">
      <span>Already have an account?</span>
      <a href="login.html">Log in</a>
    </div>
  </div>

  <!-- Camera Modal -->
  <div id="cameraModal">
    <button id="closeCameraBtn">‚úñ</button>
    <div class="modal-row">
      <div class="camera-col">
        <div class="camera-box-wrap">
          <video id="modalVideo" autoplay playsinline></video>
          <!-- canvas now 3:4 to avoid compressing face -->
          <canvas id="cameraCanvas" width="300" height="400"></canvas>
          <div id="bigGuideCircle"></div>
        </div>
        <div class="camera-warning-under" id="cameraWarning">
          ‚ö†Ô∏è For best results, use in natural daylight.<br>
          Avoid colored light and heavy shadows.
        </div>
        <button id="sampleSkinToneBtn">Sample Skin Tone</button>
      </div>

      <div class="result-col">
        <h2 style="color:#a380ff;font-weight:800;font-size:2.0rem;letter-spacing:0.5px;margin-top:0;">Skin Tone Detection</h2>
        <div class="detected-msg" id="detectedMsg" style="display:none;">Yeah, I detected your skin! üéâ</div>
        <div class="tone-preview-big" id="tonePreviewBig" style="display:none;"></div>
        <div class="tone-name" id="toneName" style="display:none;"></div>
        <button class="use-tone-btn" id="useSkinToneBtn" style="display:none;">Use This Skin Tone</button>
        <button class="use-tone-btn" id="tryAgainBtn" style="display:none;margin-left:10px;">Try Again</button>
      </div>
    </div>
  </div>

  <script>
document.addEventListener('DOMContentLoaded', () => {
  /* ===== pick ?email= from URL for Google signup & store it ===== */
  const params = new URLSearchParams(window.location.search);
  const emailFromUrl = params.get('email');
  if (emailFromUrl) {
    localStorage.setItem('signupEmail', emailFromUrl);
    localStorage.setItem('user_email', emailFromUrl);
  }

  const API_BASE = 'https://palette-and-fit-backend.onrender.com';

  /* ========== DARK MODE TOGGLE ========== */
  const darkBtn = document.getElementById('toggleDark');
  const bodyEl  = document.body;

  function updateDarkText() {
    const isDark = bodyEl.classList.contains('dark-mode');
    if (darkBtn) darkBtn.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
  }

  function toggleDarkMode() {
    const nowDark = bodyEl.classList.toggle('dark-mode');
    localStorage.setItem('darkMode', nowDark ? 'true' : 'false');
    updateDarkText();
  }

  if (localStorage.getItem('darkMode') === 'true') {
    bodyEl.classList.add('dark-mode');
  }
  updateDarkText();
  darkBtn?.addEventListener('click', toggleDarkMode);

  /* ========== SKIN TONE DATA ========== */
  const SKIN_TONES = [
    { name: "Porcelain",      hex: "#fff3e8" },
    { name: "Alabaster",      hex: "#ffe9d7" },
    { name: "Ivory",          hex: "#ffe1c7" },
    { name: "Fair",           hex: "#fdd9c0" },
    { name: "Light",          hex: "#f7cfa8" },
    { name: "Light Beige",    hex: "#f5c39a" },
    { name: "Peach",          hex: "#f2b687" },
    { name: "Almond",         hex: "#f0aa79" },
    { name: "Warm Beige",     hex: "#e9a06d" },
    { name: "Wheatish",       hex: "#e29a63" },
    { name: "Golden",         hex: "#d99054" },
    { name: "Honey",          hex: "#cf8649" },
    { name: "Caramel",        hex: "#c47941" },
    { name: "Tan",            hex: "#b76b39" },
    { name: "Bronze",         hex: "#a85f32" },
    { name: "Mocha",          hex: "#95512a" },
    { name: "Chestnut",       hex: "#834324" },
    { name: "Deep Brown",     hex: "#71371e" },
    { name: "Espresso",       hex: "#602b18" },
    { name: "Rich",           hex: "#4f2113" },
    { name: "Deep",           hex: "#411b0f" },
    { name: "Ebony",          hex: "#35140b" },
    { name: "Deep Ebony",     hex: "#270d06" },
    { name: "Ultra Deep",     hex: "#1b0703" }
  ];

  const slider     = document.getElementById('skinSlider');
  const preview    = document.getElementById('skinPreview');
  const colorInput = document.getElementById('skinToneColor');

  function toneIndexFromSlider(val) {
    const idx = Math.round(val * (SKIN_TONES.length - 1) / 100);
    return Math.max(0, Math.min(idx, SKIN_TONES.length - 1));
  }
  function getSkinColor(val) {
    return SKIN_TONES[toneIndexFromSlider(val)].hex;
  }
  function getToneName(val) {
    return SKIN_TONES[toneIndexFromSlider(val)].name;
  }
  function getIndexByToneName(name) {
    const ix = SKIN_TONES.findIndex(
      t => t.name.toLowerCase() === String(name || '').toLowerCase()
    );
    if (ix >= 0) return ix;
    return SKIN_TONES.findIndex(t => t.name === 'Wheatish');
  }

  function setSliderGradient() {
    if (!slider) return;
    const stops = SKIN_TONES.map((t, i) => {
      const pct = Math.round((i * 100) / (SKIN_TONES.length - 1));
      return `${t.hex} ${pct}%`;
    }).join(', ');
    slider.style.background = `linear-gradient(90deg, ${stops})`;
  }

  function updateSkinPreview(val) {
    if (!slider) return;
    const v = typeof val === 'undefined'
      ? parseInt(slider.value || '0', 10)
      : parseInt(val, 10);

    if (preview) preview.style.background = getSkinColor(v);
    if (colorInput) colorInput.value = getToneName(v);

    let lbl = document.getElementById('skinToneLiveName');
    if (!lbl) {
      lbl = document.createElement('span');
      lbl.id = 'skinToneLiveName';
      lbl.className = 'tone-name-fixed';
      preview?.after(lbl);
    }
    lbl.textContent = getToneName(v);
  }

  if (slider) {
    setSliderGradient();
    slider.addEventListener('input', e => updateSkinPreview(e.target.value));
    updateSkinPreview();
  }

  /* helper ‚Äì nearest tone from RGB (for camera) */
  function nearestToneFromRgb([r, g, b]) {
    let bestIdx = 0;
    let bestDiff = Infinity;
    SKIN_TONES.forEach((tone, i) => {
      const tr = parseInt(tone.hex.slice(1, 3), 16);
      const tg = parseInt(tone.hex.slice(3, 5), 16);
      const tb = parseInt(tone.hex.slice(5, 7), 16);
      const diff = Math.hypot(tr - r, tg - g, tb - b);
      if (diff < bestDiff) {
        bestDiff = diff;
        bestIdx = i;
      }
    });
    return { index: bestIdx, tone: SKIN_TONES[bestIdx] };
  }

  /* ========== PREFILL PROFILE FROM BACKEND / LOCALSTORAGE ========== */
  async function prefillForm() {
    const nameEl   = document.getElementById('name');
    const ageEl    = document.getElementById('age');
    const genderEl = document.getElementById('gender');

    const email =
      localStorage.getItem('signupEmail') ||
      localStorage.getItem('user_email');

    if (!email) return;

    try {
      const r = await fetch(`${API_BASE}/api/get_profile`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      });

      if (r.ok) {
        const data = await r.json();

        if (nameEl && data.name) nameEl.value = data.name;
        if (ageEl  && data.age)  ageEl.value  = data.age;

        if (genderEl) {
          let g = (data.gender || localStorage.getItem('signupGender') || '').toLowerCase();
          if (!g) g = 'other';
          genderEl.value = ['male', 'female', 'other'].includes(g)
            ? g
            : g.startsWith('m') ? 'male'
            : g.startsWith('f') ? 'female'
            : 'other';
        }

        if (slider && data.skin_tone) {
          const ix = getIndexByToneName(data.skin_tone);
          slider.value = Math.round(ix * 100 / (SKIN_TONES.length - 1));
          updateSkinPreview(slider.value);
        }

        localStorage.setItem('profileData', JSON.stringify({
          ...data,
          phone: (data.phone || localStorage.getItem('signupPhone') || '')
        }));

        return;
      }
    } catch (err) {
      console.warn('prefill error', err);
    }

    // fallback from localStorage only
    const pd = JSON.parse(localStorage.getItem('profileData') || '{}');

    if (nameEl && pd.name) nameEl.value = pd.name;
    if (ageEl  && pd.age)  ageEl.value  = pd.age;

    if (genderEl) {
      let g = (pd.gender || localStorage.getItem('signupGender') || '').toLowerCase();
      if (!g) g = 'other';
      genderEl.value = ['male', 'female', 'other'].includes(g)
        ? g
        : g.startsWith('m') ? 'male'
        : g.startsWith('f') ? 'female'
        : 'other';
    }

    if (slider && pd.skin_tone) {
      const ix = getIndexByToneName(pd.skin_tone);
      slider.value = Math.round(ix * 100 / (SKIN_TONES.length - 1));
      updateSkinPreview(slider.value);
    }
  }
  prefillForm();

  /* ========== CAMERA MODAL LOGIC ========== */
  const openCameraBtn  = document.getElementById('openCameraBtn');
  const cameraModal    = document.getElementById('cameraModal');
  const closeCameraBtn = document.getElementById('closeCameraBtn');
  const modalVideo     = document.getElementById('modalVideo');
  const cameraCanvas   = document.getElementById('cameraCanvas');
  const sampleBtn      = document.getElementById('sampleSkinToneBtn');
  const useSkinBtn     = document.getElementById('useSkinToneBtn');
  const detectedMsg    = document.getElementById('detectedMsg');
  const tonePreviewBig = document.getElementById('tonePreviewBig');
  const toneNameEl     = document.getElementById('toneName');
  const tryAgainBtn    = document.getElementById('tryAgainBtn');

  let stream = null;
  let sampledSliderValue = null;

  function closeModal() {
    if (!cameraModal) return;
    cameraModal.style.display = 'none';
    if (stream) {
      stream.getTracks().forEach(t => t.stop());
      stream = null;
    }
    if (modalVideo) modalVideo.srcObject = null;
  }

  function drawVideoFrame() {
    if (!cameraModal || cameraModal.style.display !== 'flex') return;
    const ctx = cameraCanvas.getContext('2d');
    ctx.drawImage(modalVideo, 0, 0, cameraCanvas.width, cameraCanvas.height);
    requestAnimationFrame(drawVideoFrame);
  }

  openCameraBtn?.addEventListener('click', async () => {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      alert('Camera not supported in this browser.');
      return;
    }
    if (!cameraModal) return;

    cameraModal.style.display = 'flex';

    try {
      /* use front camera & avoid rear */
      stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: 'user' }
      });
      modalVideo.srcObject = stream;
      await modalVideo.play();
    } catch (err) {
      alert('Camera permission required to detect skin tone.');
      closeModal();
      return;
    }

    [detectedMsg, tonePreviewBig, toneNameEl, useSkinBtn, tryAgainBtn].forEach(
      el => el && (el.style.display = 'none')
    );
    sampledSliderValue = null;
    drawVideoFrame();
  });

  closeCameraBtn?.addEventListener('click', closeModal);
  cameraModal?.addEventListener('click', e => {
    if (e.target === cameraModal) closeModal();
  });

  sampleBtn?.addEventListener('click', () => {
    const ctx = cameraCanvas.getContext('2d');
    const W = cameraCanvas.width;
    const H = cameraCanvas.height;
    const box = 60;
    const cx = Math.floor(W / 2);
    const cy = Math.floor(H / 2);
    const sx = Math.max(0, cx - box / 2);
    const sy = Math.max(0, cy - box / 2);
    const img = ctx.getImageData(sx, sy, box, box);

    let total = [0, 0, 0];
    let count = 0;
    for (let i = 0; i < img.data.length; i += 4) {
      total[0] += img.data[i];
      total[1] += img.data[i + 1];
      total[2] += img.data[i + 2];
      count++;
    }
    if (!count) return;

    const avg = total.map(x => Math.round(x / count));
    const { index, tone } = nearestToneFromRgb(avg);

    sampledSliderValue = Math.round(index * 100 / (SKIN_TONES.length - 1));

    if (detectedMsg)    detectedMsg.style.display = '';
    if (tonePreviewBig) { tonePreviewBig.style.display = ''; tonePreviewBig.style.background = tone.hex; }
    if (toneNameEl)     { toneNameEl.style.display = ''; toneNameEl.textContent = `This is your skin tone: ${tone.name}`; }
    if (useSkinBtn)     { useSkinBtn.style.display = ''; useSkinBtn.disabled = false; }
    if (tryAgainBtn)    tryAgainBtn.style.display = '';
  });

  useSkinBtn?.addEventListener('click', () => {
    if (typeof sampledSliderValue === 'number' && slider) {
      slider.value = sampledSliderValue;
      updateSkinPreview(sampledSliderValue);
    }
    closeModal();
  });

  tryAgainBtn?.addEventListener('click', () => {
    [detectedMsg, tonePreviewBig, toneNameEl, useSkinBtn, tryAgainBtn].forEach(
      el => el && (el.style.display = 'none')
    );
    sampledSliderValue = null;
  });

  /* ========== SUBMIT PROFILE TO RENDER BACKEND ========== */
  const profileForm = document.getElementById('profileForm');
  const msgDiv      = document.getElementById('profileMsg');

  profileForm?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const nameEl   = document.getElementById('name');
    const ageEl    = document.getElementById('age');
    const genderEl = document.getElementById('gender');

    const name = (nameEl?.value || '').trim();
    const age  = parseInt(ageEl?.value || '0', 10);

    let gRaw = (genderEl?.value || localStorage.getItem('signupGender') || '').trim();
    gRaw = gRaw
      ? gRaw[0].toUpperCase() + gRaw.slice(1).toLowerCase()
      : 'Other';
    const gender = ['Male', 'Female', 'Other'].includes(gRaw) ? gRaw : 'Other';

    const skinTone = colorInput?.value || 'Wheatish';

    const email =
      localStorage.getItem('signupEmail') ||
      localStorage.getItem('user_email');
    const phone =
      localStorage.getItem('signupPhone') ||
      (JSON.parse(localStorage.getItem('profileData') || '{}').phone || '');

    if (!email) {
      if (msgDiv) msgDiv.textContent = 'Signup session expired. Please signup again.';
      window.location = 'SIGNUP1.html';
      return;
    }
    localStorage.setItem('user_email', email);

    if (msgDiv) msgDiv.textContent = 'Saving profile info...';

    try {
      const res = await fetch(`${API_BASE}/api/profile`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email,
          name,
          age,
          gender,
          skin_tone: skinTone,
          phone
        })
      });

      const data = await res.json().catch(() => ({}));

      if (res.ok) {
        const prev = JSON.parse(localStorage.getItem('profileData') || '{}');
        localStorage.setItem('profileData', JSON.stringify({
          ...prev,
          email,
          name,
          age,
          gender,
          skin_tone: skinTone,
          phone
        }));
        localStorage.setItem('signupSkinTone', skinTone);

        if (msgDiv) msgDiv.textContent = 'Profile info saved! Redirecting...';
        setTimeout(() => {
          window.location = 'SIGNUP3.html';
        }, 900);
      } else {
        if (msgDiv) msgDiv.textContent =
          'Error: ' + (data.error || 'Profile not saved.');
      }
    } catch (err) {
      console.error(err);
      if (msgDiv) msgDiv.textContent = 'Network error. Please try again.';
    }
  });
});
</script>
</body>
</html>

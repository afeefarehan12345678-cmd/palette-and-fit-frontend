<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Profile â€“ Palette and Fit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Fonts & icons -->
  <link href="https://fonts.googleapis.com/css2?family=Style+Script&display=swap" rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    :root {
      --bg-light: #f7f4ee;
      --bg-mid: #ece5db;
      --bg-dark: #23242a;
      --accent: #ad00e2;
      --accent2: #c2a1ff;
      --heading: #ad00e2;
      --nav-bg: #ece5db;
      --text: #23242a;
      --button-bg: #ad00e2;
      --button-text: #fff;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--bg-light);
      color: var(--text);
      font-weight: 500;
      transition: background 0.3s, color 0.3s;
      overflow-x: hidden;
    }

    body.dark-mode {
      --bg-light: #18181b;
      --bg-mid: #23242a;
      --bg-dark: #121214;
      --nav-bg: #23242a;
      --text: #ffffff;
      --heading: #ad00e2;
      --accent: #ad00e2;
      --accent2: #c2a1ff;
      --button-bg: #5f5cff;
      --button-text: #ffffff;
      background: var(--bg-light);
      color: var(--text);
    }

    /* ================= LOGGED-IN HEADER ================= */

    header.logged-header {
      background: var(--nav-bg);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 14px #0001;
      font-weight: 600;
      padding: 0.9rem 2.4rem;
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.55rem;
      user-select: none;
      white-space: nowrap;
      cursor: pointer;
    }

    .logo img {
      height: 56px;
      width: 56px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
    }

    .logo-text {
      font-family: 'Style Script', cursive;
      font-size: 2rem;
      font-weight: 400;
      letter-spacing: 1px;
      color: #ad00e2;
      line-height: 1.05;
    }

    .nav-logged {
      display: flex;
      align-items: center;
      gap: 2rem;
      justify-content: center;
      font-weight: 400;
    }

    .nav-logged a {
      color: #2a024d;
      text-decoration: none;
      font-size: 1.02rem;
      padding: 0.25rem 0;
      cursor: pointer;
      transition: color 0.18s, font-weight 0.18s;
    }

    .nav-logged a:hover,
    .nav-logged a.active {
      color: var(--accent);
      font-weight: 700;
    }

    .wishlist-link {
      font-size: 1.08rem;
    }

    /* desktop nav dropdown (Categories) */

    .nav-logged .nav-dropdown {
      position: relative;
    }

    .nav-dropdown-toggle {
      background: none;
      border: none;
      font: inherit;
      color: #2a024d;
      display: flex;
      align-items: center;
      gap: 0.35rem;
      cursor: pointer;
      padding: 0.25rem 0;
    }

    .nav-dropdown-chevron {
      font-size: 0.75rem;
      transition: transform 0.2s ease;
    }

    .nav-dropdown-menu {
      position: absolute;
      top: calc(100% + 0.5rem);
      left: 50%;
      transform: translate(-50%, 6px);
      background: #ffffff;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.18);
      padding: 0.45rem 0.35rem;
      min-width: 130px;
      opacity: 0;
      pointer-events: none;
      z-index: 99;
      transition: opacity 0.18s ease, transform 0.18s ease;
    }

    .nav-dropdown-menu a {
      display: block;
      padding: 0.4rem 0.9rem;
      border-radius: 10px;
      white-space: nowrap;
      font-size: 0.95rem;
    }

    .nav-dropdown-menu a:hover {
      background: rgba(173,0,226,0.08);
      color: var(--accent);
    }

    .nav-dropdown:hover .nav-dropdown-menu,
    .nav-dropdown:focus-within .nav-dropdown-menu {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, 0);
    }

    .nav-dropdown:hover .nav-dropdown-chevron,
    .nav-dropdown:focus-within .nav-dropdown-chevron {
      transform: rotate(180deg);
    }

    body.dark-mode .nav-logged a {
      color: #ffffff;
    }
    body.dark-mode .nav-logged a:hover,
    body.dark-mode .nav-logged a.active {
      color: var(--accent);
    }

    body.dark-mode .nav-dropdown-toggle {
      color: #ffffff;
    }

    body.dark-mode .nav-dropdown-menu {
      background: #23242a;
      box-shadow: 0 14px 40px rgba(0,0,0,0.7);
    }

    body.dark-mode .nav-dropdown-menu a {
      color: #f5f5f5;
    }

    body.dark-mode .nav-dropdown-menu a:hover {
      background: rgba(194,161,255,0.2);
      color: #ffffff;
    }

    /* profile icon + dropdown */
    .profile-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    .profile-icon {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-left: 0.2rem;
      background: linear-gradient(135deg, #ad00e2 60%, #c2a1ff 100%);
      border: 2.2px solid #fff;
      overflow: hidden;
      padding: 0;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0,0,0,0.14);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .profile-icon svg {
      width: 23px;
      height: 23px;
    }
    .profile-icon:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.18);
    }
    body.dark-mode .profile-icon {
      border-color: #ad00e2;
    }

    .profile-menu {
      position: absolute;
      right: 0;
      top: calc(100% + 8px);
      min-width: 160px;
      background: #ffffff;
      border-radius: 14px;
      box-shadow: 0 10px 32px rgba(0,0,0,0.22);
      padding: 0.45rem 0.35rem;
      opacity: 0;
      pointer-events: none;
      transform: translateY(6px);
      transition: opacity 0.18s ease, transform 0.18s ease;
      z-index: 20;
    }
    .profile-menu.open {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }
    .profile-menu a {
      display: block;
      padding: 0.45rem 0.9rem;
      border-radius: 10px;
      text-decoration: none;
      color: var(--text);
      font-size: 0.95rem;
      white-space: nowrap;
      transition: background 0.16s ease, color 0.16s ease;
    }
    .profile-menu a:hover {
      background: rgba(173,0,226,0.08);
      color: var(--accent);
    }

    body.dark-mode .profile-menu {
      background: #23242a;
      box-shadow: 0 16px 40px rgba(0,0,0,0.7);
    }
    body.dark-mode .profile-menu a {
      color: #f5f5f5;
    }
    body.dark-mode .profile-menu a:hover {
      background: rgba(194,161,255,0.2);
      color: #ffffff;
    }

    /* header actions */

    .header-actions-logged {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .pill-btn {
      background: #7a2df6;
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 0.5rem 1.6rem;
      font-size: 0.98rem;
      font-weight: 500;
      box-shadow: 0 2px 12px #a673fa29;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.18s, transform 0.12s;
      min-height: 36px;
      white-space: nowrap;
      text-decoration: none;
      justify-content: center;
      min-width: 140px;
    }

    .pill-btn:hover,
    .pill-btn:focus-visible {
      background: #ad00e2;
      color: #fff;
      box-shadow: 0 6px 24px #a673fa49;
      outline: none;
      transform: translateY(-1px);
    }

    body.dark-mode .pill-btn {
      background: #2a024d;
    }
    body.dark-mode .pill-btn:hover,
    body.dark-mode .pill-btn:focus-visible {
      background: #7a2df6;
    }

    .darkmode-btn .dm-icon {
      font-size: 1.1em;
    }

    /* Hamburger */

    .hamburger-logged {
      background: none;
      border: none;
      cursor: pointer;
      display: none;
    }
    .hamburger-logged-box {
      position: relative;
      width: 20px;
      height: 2px;
    }
    .hamburger-logged-inner,
    .hamburger-logged-inner::before,
    .hamburger-logged-inner::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      border-radius: 2px;
      background: #7a2df6;
      transition: transform 0.28s cubic-bezier(.55,.06,.68,.19), top 0.2s, opacity 0.2s;
    }
    .hamburger-logged-inner { top: 0; }
    .hamburger-logged-inner::before { top: -6px; }
    .hamburger-logged-inner::after  { top:  6px; }

    .hamburger-logged.is-active .hamburger-logged-inner {
      transform: rotate(45deg);
    }
    .hamburger-logged.is-active .hamburger-logged-inner::before {
      top: 0;
      transform: rotate(-90deg);
    }
    .hamburger-logged.is-active .hamburger-logged-inner::after {
      top: 0;
      opacity: 0;
    }

    @media (max-width: 1200px) {
      header.logged-header {
        padding: 0.8rem 1.2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .nav-logged {
        display: none;
      }
      .header-actions-logged {
        gap: 0.4rem;
      }
      .hamburger-logged {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        padding: 0;
        border-radius: 8px;
        border: 1px solid rgba(173, 0, 226, 0.25);
        background: transparent;
      }
      .header-actions-logged .darkmode-btn {
        display: none;
      }
      .profile-wrapper {
        display: none;
      }
      .logo img {
        height: 44px;
        width: 44px;
      }
      .logo-text {
        font-size: 1.6rem;
      }
    }

    /* ================= LOGGED-IN DRAWER ================= */

    .nav-drawer-backdrop-logged {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.28);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
      z-index: 120;
    }
    .nav-drawer-backdrop-logged.open {
      opacity: 1;
      pointer-events: auto;
    }

    .nav-drawer-logged {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: min(320px, 80vw);
      background: var(--bg-light);
      box-shadow: -16px 0 38px rgba(0, 0, 0, 0.28);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 130;
      display: flex;
      flex-direction: column;
      padding: 1.5rem 1.4rem 1.6rem;
    }
    body.dark-mode .nav-drawer-logged {
      background: var(--bg-dark);
    }
    .nav-drawer-logged.open {
      transform: translateX(0);
    }

    .drawer-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.2rem;
    }

    .drawer-title {
      font-family: 'Style Script', cursive;
      font-size: 1.55rem;
      color: var(--accent);
      letter-spacing: 0.03em;
      white-space: nowrap;
    }

    .drawer-close {
      background: none;
      border: none;
      font-size: 1.35rem;
      line-height: 1;
      padding: 0.15rem 0.4rem;
      border-radius: 999px;
      cursor: pointer;
      color: #e3c7ff;
      transition: background 0.18s, transform 0.18s, color 0.18s;
    }

    .drawer-close:hover {
      background: rgba(173, 0, 226, 0.16);
      color: #ffffff;
      transform: rotate(90deg);
    }

    .drawer-links-logged {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      padding: 0.2rem 0 1.6rem;
    }

    .drawer-links-logged a {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      text-decoration: none;
      color: var(--text);
      font-size: 1.05rem;
      padding: 0.5rem 0.7rem;
      border-radius: 999px;
      transition: background 0.18s, color 0.18s, transform 0.1s;
    }

    .drawer-links-logged a:hover,
    .drawer-links-logged a:focus-visible {
      background: rgba(173, 0, 226, 0.12);
      color: var(--accent);
      transform: translateX(3px);
      outline: none;
    }

    .drawer-links-logged a.active {
      font-weight: 600;
      color: var(--accent);
      background: rgba(173, 0, 226, 0.16);
    }

    .drawer-icon {
      width: 1.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .drawer-icon i {
      font-size: 1.05rem;
      color: var(--accent);
    }

    .drawer-label {
      flex: 1;
    }

    body.dark-mode .drawer-links-logged a {
      color: #f7f4ee;
    }

    body.dark-mode .drawer-links-logged a:hover,
    body-dark-mode .drawer-links-logged a:focus-visible {
      background: rgba(194, 161, 255, 0.18);
      color: #ffffff;
    }

    body.dark-mode .drawer-links-logged a.active {
      background: rgba(194,161,255,0.25);
      color: #ffffff;
    }
    body.dark-mode .drawer-links-logged a.active .drawer-icon i {
      color: #ffffff;
    }

    body.dark-mode .drawer-icon i {
      color: var(--accent2);
    }

    .drawer-actions-logged {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      padding-top: 1.1rem;
    }
    .drawer-actions-logged .pill-btn {
      width: 100%;
      min-width: 0;
    }

    /* drawer group (Shop accordion) */

    .drawer-group {
      margin-bottom: 0.25rem;
    }

    .drawer-group-toggle {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.5rem 0.7rem;
      border-radius: 999px;
      border: none;
      background: transparent;
      color: var(--text);
      font-size: 1.05rem;
      cursor: pointer;
      text-align: left;
      transition: background 0.18s, color 0.18s, transform 0.1s;
    }

    .drawer-group-toggle:hover,
    .drawer-group-toggle:focus-visible {
      background: rgba(173,0,226,0.12);
      color: var(--accent);
      transform: translateX(3px);
      outline: none;
    }

    .drawer-chevron {
      margin-left: auto;
      font-size: 0.8rem;
      transition: transform 0.18s ease;
    }

    .drawer-group-menu {
      display: none;
      padding: 0.2rem 0 0.3rem 2.4rem;
    }

    .drawer-group-menu a {
      padding: 0.4rem 0.2rem;
      font-size: 0.97rem;
      border-radius: 999px;
    }

    .drawer-group.open .drawer-group-menu {
      display: block;
    }

    .drawer-group.open .drawer-chevron {
      transform: rotate(180deg);
    }

    body.dark-mode .drawer-group-toggle {
      color: #f7f4ee;
    }
    body.dark-mode .drawer-group-toggle:hover,
    body-dark-mode .drawer-group-toggle:focus-visible {
      background: rgba(194,161,255,0.18);
      color: #ffffff;
    }

    /* ================= PROFILE SECTION ================= */

    main {
      padding: 1.5rem 0 2.5rem;
    }

    .section-profile {
      max-width: 1180px;
      margin: 1.5rem auto 0;
      padding: 0 1.2rem;
    }

    .profile-section {
      display: flex;
      flex-direction: row;
      gap: 2.2rem;
      align-items: flex-start;
      max-width: 1100px;
      margin: 2rem auto;
      padding: 2rem 1rem;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 6px 24px #ad00e219;
    }

    body.dark-mode .profile-section {
      background: #191921;
      box-shadow: 0 8px 26px #0006;
    }

    .profile-sidebar {
      flex: 0 0 270px;
      min-width: 220px;
      max-width: 320px;
      margin-bottom: 0;
      background: #fff;
      border-radius: 14px;
      padding: 2rem 1rem 1.5rem 1.2rem;
      text-align: left;
      box-shadow: 0 2px 16px #ad00e222;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    body.dark-mode .profile-sidebar { background: #15131a; }

    .profile-sidebar h2,
    .profile-sidebar p,
    .profile-sidebar .sidebar-info-label {
      color: #191921;
    }

    body.dark-mode .profile-sidebar h2,
    body.dark-mode .profile-sidebar p,
    body-dark-mode .profile-sidebar .sidebar-info-label {
      color: #fff;
    }

    .profile-avatar {
      width: 88px;
      height: 88px;
      border-radius: 50%;
      margin: 0 auto 0.7rem;
      background: linear-gradient(135deg,#ad00e2 60%,#c2a1ff 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    .profile-avatar img {
      width: 82px; height: 82px;
      border-radius: 50%;
      background: #fff;
      object-fit: cover;
      display: block;
    }

    .upload-btn {
      margin-top: 0.7rem;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .upload-btn label {
      cursor: pointer;
      font-size: 0.98rem;
      color: var(--accent);
      text-decoration: none;
      display: flex;
      align-items: center;
      font-weight: 600;
      gap: 5px;
    }

    .upload-btn input[type="file"] { display: none; }

    .upload-btn label::before {
      content: "ðŸ“·";
      font-size: 1.19em;
      margin-right: 2px;
      vertical-align: middle;
      opacity: 0.85;
    }

    body.dark-mode .upload-btn label { color: #ffadf8; }

    .sidebar-info-label {
      font-weight: 700;
      margin-bottom: 2px;
      display: block;
      color: #ad00e2;
    }

    .sidebar-info-item {
      margin-bottom: 0.6em;
      font-size: 1.02em;
      color: #222;
      word-break: break-word;
      text-align: left;
      width: 100%;
    }

    body.dark-mode .sidebar-info-item { color: #fff; }

    .profile-main {
      flex: 1 1 0;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2.1rem;
    }

    .profile-info-card {
      background: #fff;
      color: #191921;
      border-radius: 12px;
      padding: 1.6rem 2.2rem 1.2rem 2rem;
      box-shadow: 0 1px 6px #ad00e218;
    }

    body.dark-mode .profile-info-card {
      background: #191921;
      color: #eee;
    }

    .profile-info-row {
      display: flex;
      flex-wrap: wrap;
      gap: 2.5rem 3.6rem;
    }

    .profile-info-label {
      font-weight: 700;
      color: var(--accent);
      min-width: 120px;
      margin-bottom: 0.3rem;
      font-size: 1.05em;
    }

    .profile-info-group {
      margin-bottom: 0.6rem;
      flex: 1 1 230px;
    }

    .profile-info-value {
      font-weight: 400;
      color: #191921;
    }

    body.dark-mode .profile-info-value {
      color: #fff;
    }

    .edit-btn {
      margin-top: 1.2rem;
      background: var(--button-bg);
      color: var(--button-text);
      border: none;
      border-radius: 6px;
      padding: 0.42rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.18s;
    }

    .edit-btn:hover { background: var(--accent); }

    .profile-info-group select {
      padding: 0.38em 1.7em 0.38em 0.7em;
      border-radius: 10px;
      border: 2px solid #ad00e2;
      font-size: 1em;
      font-family: inherit;
      background: #fff !important;
      color: #462a5e !important;
      font-weight: 600;
      box-shadow: 0 2px 14px #ad00e217;
      margin-top: 0.2em;
      margin-bottom: 0.1em;
      cursor: pointer;
      appearance: none;
      min-width: 110px;
      background-image: url("data:image/svg+xml,%3Csvg width='10' height='7' viewBox='0 0 10 7' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%23462a5e' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.8em center;
      background-size: 16px 12px;
      transition: border 0.18s, box-shadow 0.18s, background 0.18s, color 0.18s;
      outline: none;
    }

    .profile-info-group select:focus {
      border: 2px solid #ad00e2 !important;
      background: #f8f6f2 !important;
      color: #2a024d !important;
    }

    body.dark-mode .profile-info-group select {
      background-color: #fff !important;
      color: #2a024d !important;
      border: 2px solid #ad00e2 !important;
      box-shadow: 0 2px 14px #ad00e217 !important;
      background-image:
        url("data:image/svg+xml,%3Csvg width='20' height='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpolyline points='0,5 5,0 10,5 15,0 20,5' stroke='%23ad00e2' stroke-width='2' fill='none'/%3E%3C/svg%3E"),
        url("data:image/svg+xml,%3Csvg width='10' height='7' viewBox='0 0 10 7' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%232a024d' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: repeat-y, no-repeat;
      background-position: right 2.2em center, right 0.8em center;
      background-size: 20px 20px, 16px 12px;
    }

    body.dark-mode .profile-info-group select:focus {
      background: #f8f6f2 !important;
      border: 2.2px solid #ad00e2 !important;
      color: #2a024d !important;
    }

    .profile-status-row {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      margin-top: 1.2rem;
    }

    .status-card {
      flex: 1 1 370px;
      min-width: 300px;
      background: #22222a;
      border-radius: 11px;
      padding: 1.4rem 1.2rem;
      box-shadow: 0 1px 8px #ad00e219;
      margin-bottom: 1rem;
    }

    body.dark-mode .status-card {
      background: #18181f;
      color: #eee;
    }

    .status-title {
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 1rem;
      font-size: 1.12rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .progress-row { margin-bottom: 0.88rem; }

    .progress-label {
      font-size: 0.97rem;
      font-weight: 500;
      color: #aaa;
      margin-bottom: 0.3rem;
    }

    body.dark-mode .progress-label { color: #bbb; }

    .progress-bar-bg {
      width: 100%;
      background: #e0e0e0;
      border-radius: 7px;
      height: 10px;
      overflow: hidden;
      margin-bottom: 0.4rem;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #ad00e2 50%, #c2a1ff 100%);
      border-radius: 7px;
      transition: width 0.4s;
    }

    .bar-label {
      font-size: 0.98rem;
      color: #888;
      margin-left: 0.5em;
    }

    .color-swatch {
      width:28px;height:28px;border-radius:8px;box-shadow:0 1px 5px #bbb6aa55; display:inline-block;
    }
    .color-key {
      color: #a9947a;
      font-weight: 700;
      padding: 1px 5px;
      border-radius: 4px;
      background: #f4ede6;
    }
    .color-key.mustard { color: #b39c4d; background: #f6f3e2; }

    body.dark-mode .color-key,
    body.dark-mode .color-key.mustard {
      color: #ffe4ad !important;
      background: #4e473b !important;
    }

    .worst-color {
      color: #e23c3c;
      font-weight: 600;
      background: #fbeeee;
      border-radius: 6px;
      padding: 2px 8px;
      box-shadow: 0 1px 3px #e23c3c11;
      margin-left: 0.3em;
    }
    body.dark-mode .worst-color {
      color: #fff0f0;
      background: #522222;
    }

    @media (max-width: 980px) {
      .profile-section {
        flex-direction: column;
        align-items: stretch;
        gap: 1.5rem;
        padding: 1.5rem 0.5rem;
      }
      .profile-sidebar {
        max-width: 100%;
        min-width: 0;
        margin: 0 auto 1.2rem auto;
        padding: 1.2rem 0.5rem 1rem 0.5rem;
      }
      .profile-main {
        gap: 1.2rem;
        min-width: 0;
      }
    }

    @media (max-width: 600px) {
      .profile-section {
        padding: 0.8rem 0.1rem;
        border-radius: 10px;
      }
      .profile-sidebar {
        padding: 0.7rem 0.1rem 0.6rem 0.1rem;
        border-radius: 8px;
        box-shadow: 0 1px 8px #ad00e211;
      }
      .profile-main,
      .profile-info-card,
      .status-card {
        padding: 0.8rem !important;
        border-radius: 10px;
      }
    }

    /* ===== SKIN TONE SLIDER, PREVIEW, CAMERA BUTTON (EDIT FORM) ===== */
    .skin-tone-row {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-top: 7px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .skin-preview {
      display: inline-block;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2.2px solid #bbb;
      box-shadow: 0 1px 8px #ad00e210;
      background: #eac086;
      vertical-align: middle;
      margin-right: 5px;
      transition: background 0.2s, border 0.2s;
    }
    .skin-slider {
      accent-color: var(--accent);
      width: 110px;
      max-width: 42vw;
      margin-right: 7px;
      cursor: pointer;
    }
    .camera-btn {
      display: flex;
      align-items: center;
      gap: 3px;
      background: linear-gradient(90deg,#ad00e2 65%,#c2a1ff 100%);
      color: #fff;
      font-size: 0.97em;
      border: none;
      border-radius: 7px;
      padding: 0.43em 1em 0.43em 0.8em;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 2px 14px #ad00e233;
      transition: background 0.18s;
      margin-left: 3px;
      outline: none;
    }
    .camera-btn:hover,
    .camera-btn:focus {
      background: #7a2df6;
      color: #fff;
      box-shadow: 0 5px 16px #a673fa33;
    }
    body.dark-mode .camera-btn {
      background: #2a024d;
      color: #fff;
    }
    body.dark-mode .camera-btn:hover,
    body.dark-mode .camera-btn:focus {
      background: #7a2df6;
    }
    .skin-tone-dot {
      width: 26px; height: 26px; border-radius: 50%; border:2.5px solid #ccc; margin-right: 5px; display:inline-block; transition: border .22s;
    }
    .skin-tone-dot.active { border: 3px solid #ad00e2; box-shadow:0 1px 8px #ad00e222; }

    .edit-form input,
    .edit-form select {
      font-size:1.01em;
      padding:.38em .8em;
      border-radius:7px;
      border:1.5px solid #d4c4ef;
      margin-bottom:.5em;
      width:96%;
    }
    .edit-form label {
      font-weight:600;
      color:var(--accent);
      margin-bottom:2px;
      display:block;
    }
    .edit-actions {
      margin-top: 1.1em;
      display:flex;
      gap:1em;
    }
    .edit-btn-save { background: #ad00e2; color:#fff;}
    .edit-btn-cancel { background: #e6e6e6; color: #20144a;}

    /* ===== HELP TOOLTIP "i" BADGE ===== */
    .help-icon {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 1.5px solid #ad00e2;
      font-size: 0.7rem;
      font-weight: 700;
      color: #ad00e2;
      margin-left: 6px;
      position: relative;
      cursor: default;
      background: #ffffff;
      flex-shrink: 0;
    }
    .help-icon .help-tooltip {
      position: absolute;
      left: 50%;
      bottom: 120%;
      transform: translateX(-50%) translateY(4px);
      background: #23242a;
      color: #ffffff;
      padding: 0.4rem 0.6rem;
      border-radius: 8px;
      font-size: 0.78rem;
      width: 220px;
      max-width: 70vw;
      box-shadow: 0 4px 16px rgba(0,0,0,0.25);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease, transform 0.18s ease;
      z-index: 50;
      line-height: 1.4;
    }
    .help-icon .help-tooltip::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 6px;
      border-style: solid;
      border-color: #23242a transparent transparent transparent;
    }
    .help-icon:hover .help-tooltip {
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }
    body.dark-mode .help-icon {
      background: #18181b;
      border-color: #c2a1ff;
      color: #c2a1ff;
    }
    body.dark-mode .help-icon .help-tooltip {
      background: #f4e9ff;
      color: #20144a;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    }
    body.dark-mode .help-icon .help-tooltip::after {
      border-color: #f4e9ff transparent transparent transparent;
    }

    #cameraModal {
      display:none;
      position:fixed;
      inset:0;
      z-index:1111;
      background:rgba(20,15,27,0.97);
      justify-content:center;
      align-items:center;
      padding:4vh 0.75rem;
      overflow-y:auto;
    }
    #cameraModal .modal-row {
      display: flex;
      flex-direction: row;
      width: min(960px, 100% - 1.5rem);
      min-height: 60vh;
      background: #fff;
      border-radius: 2.5rem;
      box-shadow: 0 8px 32px #0003;
      overflow: hidden;
      margin:auto;
    }
    #cameraModal .camera-col {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: #130d20;
      position: relative;
      min-width: 280px;
      min-height: 340px;
      padding-top: 36px;
      padding-bottom: 20px;
    }
    .camera-box-wrap {
      width: 96%;
      max-width: 340px;
      aspect-ratio: 320/380;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #modalVideo, #cameraCanvas, #bigGuideCircle {
      width: 100%;
      height: 100%;
      position: absolute;
      left: 0; top: 0;
      object-fit: cover;
      border-radius: 2rem;
    }
    #bigGuideCircle {
      border: 6px solid #ad00e2;
      border-radius: 50%;
      z-index: 3; pointer-events: none;
      box-shadow: 0 0 0 8px #ad00e233;
    }
    .camera-warning-under {
      width: 96%;
      max-width: 340px;
      margin: 16px auto 0 auto;
      background: #24123f;
      color: #ffd400;
      border-radius: 1.1rem;
      box-shadow: 0 2px 18px #20144a27;
      font-size: 1.05rem;
      font-weight: 600;
      padding: 13px 18px 10px 18px;
      z-index: 10;
      border: 1.2px solid #ffd40038;
      text-align: center;
      letter-spacing: 0.01em;
      transition: background 0.19s;
    }
    #sampleSkinToneBtn {
      background: linear-gradient(90deg, #ad00e2 80%, #bd7ffe 100%);
      color: #fff;
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.04em;
      border: none;
      border-radius: 1.2rem;
      padding: 1rem 2.2rem;
      box-shadow: 0 2px 16px #ad00e236;
      cursor: pointer;
      margin: 18px 0 10px 0;
      transition: background 0.23s;
    }
    #sampleSkinToneBtn:hover {
      background: linear-gradient(90deg, #bd7ffe 10%, #ad00e2 90%);
    }
    #closeCameraBtn {
      position:fixed;
      right:2vw;
      top:2vh;
      font-size:2.2rem;
      background:none;
      border:none;
      color:#fff;
      cursor:pointer;
      z-index:1120;
    }
    /* Result Col */
    #cameraModal .result-col {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2.5rem 1.2rem 2.5rem 2.5rem;
      min-width: 280px;
      background: linear-gradient(120deg, #f6f3fc 65%, #f2edff 100%);
    }
    #cameraModal .detected-msg {
      color: #20144a; font-size: 1.18rem; font-weight: 700; margin-bottom: 0.7rem; margin-top: 1.2rem;
    }
    #cameraModal .tone-preview-big {
      margin: 1.1rem 0 0.6rem 0; width: 60px; height: 60px; border-radius: 50%;
      border: 4px solid #ad00e2;
      box-shadow: 0 4px 18px #ad00e233;
      display: inline-block;
    }
    #cameraModal .tone-name {
      font-size: 1.13rem; font-weight: 700; color: #ad00e2; margin-bottom: 1.5rem;
    }
    #cameraModal .use-tone-btn {
      padding: 0.85rem 2.3rem;
      font-size: 1.1rem;
      border-radius: 1.1rem;
      background: #ad00e2;
      color: #fff;
      border: none;
      font-weight: 700;
      box-shadow: 0 2px 12px #a084f760;
      cursor: pointer;
      margin-top: 0.7rem;
    }
    #cameraModal .use-tone-btn:disabled {
      background: #d1a67d; color: #fff; cursor: not-allowed; opacity: 0.8;
    }
    @media (max-width: 800px) {
      #cameraModal .modal-row {
        flex-direction: column;
        min-height: auto;
        border-radius: 1.8rem;
      }
      #cameraModal .camera-col,
      #cameraModal .result-col {
        min-width: unset;
        width: 100%;
        min-height: 240px;
        padding: 1.1rem 1rem 1.4rem;
      }
      #cameraModal .camera-col {
        min-height: 280px;
      }
      .camera-box-wrap,
      .camera-warning-under {
        max-width: 96vw;
      }
    }
    @media (max-width: 480px) {
      #cameraModal {
        padding: 3vh 0.4rem;
      }
      #cameraModal .modal-row {
        width: 100%;
        border-radius: 1.4rem;
      }
      #closeCameraBtn {
        right: 4vw;
        top: 1.4vh;
      }
    }

    .recommendation-box {
      background: linear-gradient(110deg, #fff 80%, #eedeff 100%);
      border: 1.5px solid #ad00e2;
      border-radius: 12px;
      padding: 1.3em 1.1em 1.2em 1.3em;
      margin-top: 1em;
      margin-bottom: 1.4em;
      font-size: 1.12rem;
      color: #31214c;
      box-shadow: 0 4px 24px #ad00e223, 0 1.5px 10px #c2a1ff18;
      line-height: 1.67;
      font-weight: 500;
      white-space: pre-line;
      transition: background 0.3s;
    }
    body.dark-mode .recommendation-box {
      background: linear-gradient(105deg, #28223b 60%, #432d6e 100%);
      color: #ffeafd;
      border: 1.5px solid #a77bff;
      box-shadow: 0 4px 24px #ad00e233, 0 1.5px 10px #2221;
    }

    /* ===== LOGOUT BUTTON & MODAL ===== */
    .logout-btn-bully {
      background: linear-gradient(90deg,#f80039 65%,#e22 100%);
      color: #fff;
      font-size: 0.95rem;
      font-weight: 800;
      border: none;
      border-radius: 8px;
      padding: 0.35em 1em 0.35em 1em;
      letter-spacing: .06em;
      box-shadow: 0 2px 12px #e4002238, 0 1px 4px #ee285618;
      text-transform: uppercase;
      cursor: pointer;
      outline: none;
      transition: background .16s, box-shadow .18s, transform .12s;
      position: relative;
      z-index: 5;
      border: 2px solid #fff1;
      max-width: 140px;
      width: 100%;
    }
    .logout-btn-bully:hover,
    .logout-btn-bully:focus {
      background: linear-gradient(90deg,#e60023 70%,#b80022 100%);
      box-shadow: 0 5px 20px #e4002275, 0 1px 6px #ee2856aa;
      transform: scale(1.06) translateY(-1px);
      border: 2px solid #fff3;
    }
    .logout-btn-bully:active {
      background: #b80022;
      box-shadow: 0 1px 6px #e4002213;
      transform: scale(0.98);
    }
    body.dark-mode .logout-btn-bully {
      background: linear-gradient(90deg,#ff397a 80%,#c70039 100%);
      border: 2px solid #fff1;
    }
    body.dark-mode .logout-btn-bully:hover,
    body-dark-mode .logout-btn-bully:focus {
      background: linear-gradient(90deg,#e60023 85%,#7a143a 100%);
      box-shadow: 0 6px 26px #c700398a, 0 2px 7px #ff397a99;
      border: 2px solid #fff3;
    }

    #logoutConfirmModal .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 9998;
    }

    #logoutConfirmModal .modal-content {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-light);
      color: var(--text);
      padding: 2rem 2.4rem;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(122,45,246,0.35);
      max-width: 360px;
      width: 90vw;
      z-index: 9999;
      text-align: center;
      font-weight: 600;
    }

    body.dark-mode #logoutConfirmModal .modal-content {
      background: #23242a;
      color: #eee;
      box-shadow: 0 8px 32px rgba(173,0,226,0.6);
    }

    #logoutConfirmModal h2 {
      margin-bottom: 0.8rem;
      color: var(--accent);
      font-size: 1.6rem;
      font-weight: 700;
    }

    #logoutConfirmModal p {
      font-size: 1.1rem;
      margin-bottom: 1.6rem;
      color: var(--text);
    }

    body.dark-mode #logoutConfirmModal p {
      color: #ddd;
    }

    #logoutConfirmModal .modal-actions {
      display: flex;
      justify-content: center;
      gap: 1.3rem;
    }

    #logoutConfirmModal .btn {
      flex: 1;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.3s ease;
      font-size: 1rem;
    }

    #logoutConfirmModal .confirm-btn {
      background: linear-gradient(90deg,#f80039 65%,#e22 100%);
      color: white;
      box-shadow: 0 3px 10px #e4002244;
    }
    #logoutConfirmModal .confirm-btn:hover {
      background: linear-gradient(90deg,#e60023 80%,#b80022 100%);
    }

    #logoutConfirmModal .cancel-btn {
      background: #ccc;
      color: #222;
      box-shadow: 0 2px 8px #9999;
    }
    #logoutConfirmModal .cancel-btn:hover {
      background: #bbb;
    }
    body.dark-mode #logoutConfirmModal .cancel-btn {
      background: #444;
      color: #eee;
      box-shadow: 0 2px 8px #555;
    }
    body.dark-mode #logoutConfirmModal .cancel-btn:hover {
      background: #555;
    }

    /* ================= FOOTER ================= */

    footer {
      background: #444b4b;
      color: #eee;
      padding: 2.5rem 0 1.2rem;
      margin-top: 2rem;
    }

    footer a {
      color: #fff;
      text-decoration: none;
    }

    footer strong {
      color: #fff;
    }

    .footer-main {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1.5rem;
      padding: 0 1.4rem;
      font-size: 0.96rem;
    }

    .footer-col {
      flex: 1 1 200px;
      min-width: 180px;
    }

    body.dark-mode footer {
      background: #18181b;
      color: #ccc;
    }

    body.dark-mode footer a {
      color: #aaa;
    }

    @media (max-width: 800px) {
      .footer-main {
        flex-direction: column;
        gap: 0.7rem;
        align-items: flex-start;
      }
    }

    @media (max-width: 500px) {
      .footer-main {
        padding-left: 6vw;
        padding-right: 6vw;
      }
    }
    /* 1) Drawer links hover */
body.dark-mode .drawer-links-logged a:hover,
body.dark-mode .drawer-links-logged a:focus-visible {
  background: rgba(194,161,255,0.18);
  color: #ffffff;
}

/* 2) Drawer group toggle hover */
body.dark-mode .drawer-group-toggle:hover,
body.dark-mode .drawer-group-toggle:focus-visible {
  background: rgba(194,161,255,0.18);
  color: #ffffff;
}

/* 3) Sidebar text color */
body.dark-mode .profile-sidebar h2,
body.dark-mode .profile-sidebar p,
body.dark-mode .profile-sidebar .sidebar-info-label {
  color: #fff;
}

/* 4) Logout button hover state */
body.dark-mode .logout-btn-bully:hover,
body.dark-mode .logout-btn-bully:focus {
  background: linear-gradient(90deg,#e60023 85%,#7a143a 100%);
  box-shadow: 0 6px 26px #c700398a, 0 2px 7px #ff397a99;
  border: 2px solid #fff3;
}

  </style>
</head>
<body>

  <!-- LOGGED-IN HEADER -->
  <header class="logged-header" id="userHeader">
    <div class="logo">
      <img src="palette and fit logo.png" alt="Palette and Fit logo">
      <span class="logo-text">Palette and Fit</span>
    </div>

    <nav class="nav-logged">
      <a href="homepage1.html">Home</a>

      <div class="nav-dropdown">
        <button class="nav-dropdown-toggle" type="button">
          <span>Categories</span>
          <i class="fa-solid fa-chevron-down nav-dropdown-chevron" aria-hidden="true"></i>
        </button>
        <div class="nav-dropdown-menu">
          <a href="men.html">Men</a>
          <a href="women.html">Women</a>
        </div>
      </div>

      <a href="aboutus.html">About us</a>
      <a href="contactus.html">Contact us</a>
      <a href="Suggestionpage.html">Get suggestion</a>
      <a href="wishlist.html" class="wishlist-link">â™¡ Wishlist</a>
    </nav>

    <div class="header-actions-logged">
      <div class="profile-wrapper">
        <button class="profile-icon" id="profileToggleUser" aria-haspopup="true" aria-expanded="false">
          <svg viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="8.5" r="4.2" fill="#fff" fill-opacity=".95"></circle>
            <ellipse cx="12" cy="18" rx="7" ry="3.2" fill="#fff" fill-opacity=".38"></ellipse>
          </svg>
        </button>
        <div class="profile-menu" id="profileMenuUser">
          <a href="profile.html" aria-current="page">Profile</a>
          <a href="#" class="logout-link">Log out</a>
        </div>
      </div>

      <!-- desktop dark mode -->
      <button class="pill-btn darkmode-btn" id="darkModeToggleUser" aria-pressed="false">
        <span class="dm-icon">ðŸŒ™</span>
        <span class="dm-text">Dark Mode</span>
      </button>

      <button class="hamburger-logged" id="navToggleUser" aria-label="Toggle menu" aria-expanded="false">
        <span class="hamburger-logged-box"><span class="hamburger-logged-inner"></span></span>
      </button>
    </div>
  </header>

  <!-- Drawer + backdrop -->
  <div class="nav-drawer-backdrop-logged" id="navBackdropUser"></div>

  <aside class="nav-drawer-logged" id="navDrawerUser" aria-hidden="true">
    <div class="drawer-header">
      <span class="drawer-title">Palette &amp; Fit</span>
      <button class="drawer-close" id="drawerCloseUser" aria-label="Close menu">&times;</button>
    </div>

    <div class="drawer-links-logged">
      <a href="homepage1.html">
        <span class="drawer-icon"><i class="fa-solid fa-house"></i></span>
        <span class="drawer-label">Home</span>
      </a>

      <div class="drawer-group open">
        <button class="drawer-group-toggle" type="button">
          <span class="drawer-icon"><i class="fa-solid fa-shirt"></i></span>
          <span class="drawer-label">Shop</span>
          <span class="drawer-chevron"><i class="fa-solid fa-chevron-down"></i></span>
        </button>
        <div class="drawer-group-menu" id="drawerShopMenuUser">
          <a href="men.html">Men</a>
          <a href="women.html">Women</a>
        </div>
      </div>

      <a href="aboutus.html">
        <span class="drawer-icon"><i class="fa-solid fa-circle-info"></i></span>
        <span class="drawer-label">About us</span>
      </a>
      <a href="contactus.html">
        <span class="drawer-icon"><i class="fa-solid fa-envelope"></i></span>
        <span class="drawer-label">Contact us</span>
      </a>
      <a href="Suggestionpage.html">
        <span class="drawer-icon"><i class="fa-solid fa-wand-magic-sparkles"></i></span>
        <span class="drawer-label">Get suggestion</span>
      </a>
      <a href="privacy.html">
        <span class="drawer-icon"><i class="fa-solid fa-shield-halved"></i></span>
        <span class="drawer-label">Privacy policy</span>
      </a>
      <a href="terms.html">
        <span class="drawer-icon"><i class="fa-regular fa-file-lines"></i></span>
        <span class="drawer-label">Terms &amp; Conditions</span>
      </a>
      <a href="wishlist.html">
        <span class="drawer-icon"><i class="fa-regular fa-heart"></i></span>
        <span class="drawer-label">Wishlist</span>
      </a>
      <a href="profile.html">
        <span class="drawer-icon"><i class="fa-regular fa-user"></i></span>
        <span class="drawer-label">Profile</span>
      </a>
    </div>

    <div class="drawer-actions-logged">
      <!-- mobile dark mode pill near logout -->
      <button class="pill-btn darkmode-btn" id="drawerDarkToggleUser" aria-pressed="false">
        <span class="dm-icon">ðŸŒ™</span>
        <span class="dm-text">Dark Mode</span>
      </button>
      <button class="pill-btn logout-link">Log out</button>
    </div>
  </aside>

  <!-- MAIN PROFILE CONTENT -->
  <main>
    <section class="section-profile">
      <div class="profile-section">
        <!-- Sidebar -->
        <aside class="profile-sidebar">
          <div class="profile-avatar" id="avatarBox">
            <img id="profilePic"
              src="https://cdn.vectorstock.com/i/1000v/54/41/young-and-elegant-woman-avatar-profile-vector-9685441.jpg"
              alt="Avatar"
            >
          </div>
          <div class="upload-btn">
            <label for="fileInput">Upload Profile Picture</label>
            <input type="file" id="fileInput" accept="image/*">
          </div>
          <h2 id="profileName" style="text-align: center;">Ayesha Khan</h2>
          <p style="text-align: center;">Member<br>Palette and Fit Community</p>
          <div style="text-align: left; margin-top: 1.5rem; width: 100%;">
            <div class="sidebar-info-item">
              <span class="sidebar-info-label">Email:</span>
              <span id="profileEmail">ayesha@email.com</span>
            </div>
            <div class="sidebar-info-item">
              <span class="sidebar-info-label">Phone:</span>
              <span id="profilePhone">0301-1234567</span>
            </div>
            <div class="sidebar-info-item">
              <span class="sidebar-info-label">Age:</span>
              <span id="profileAge">24</span>
            </div>
          </div>
        </aside>

        <!-- Main Profile Info -->
        <div class="profile-main">
          <!-- View Profile -->
          <div class="profile-info-card" id="profileView">
            <div class="profile-info-row">
              <div class="profile-info-group">
                <div class="profile-info-label">Full Name</div>
                <div class="profile-info-value" id="infoName">Ayesha Khan</div>
              </div>
              <div class="profile-info-group">
                <div class="profile-info-label">Email</div>
                <div class="profile-info-value" id="infoEmail">ayesha@email.com</div>
              </div>
              <div class="profile-info-group">
                <div class="profile-info-label">Phone</div>
                <div class="profile-info-value" id="infoPhone">0301-1234567</div>
              </div>
              <div class="profile-info-group">
                <div class="profile-info-label">Gender</div>
                <div class="profile-info-value" id="infoGender">Female</div>
              </div>
              <div class="profile-info-group">
                <div class="profile-info-label">Skin Tone</div>
                <div class="profile-info-value" id="infoTone">
                  <span id="skinToneDot" class="skin-tone-dot" style="background:#eac086;"></span>
                  <span id="skinToneName">Wheatish</span>
                </div>
              </div>
              <div class="profile-info-group">
                <div class="profile-info-label">Age</div>
                <div class="profile-info-value" id="infoAge">24</div>
              </div>
              <div class="profile-info-group">
                <div class="profile-info-label">Weight (kg)</div>
                <div class="profile-info-value" id="infoWeight">58</div>
              </div>
              <div class="profile-info-group">
                <div class="profile-info-label">Body Length (in)</div>
                <div class="profile-info-value" id="infoLength">60</div>
              </div>
              <div class="profile-info-group">
                <div class="profile-info-label">Upper Body Width (in)</div>
                <div class="profile-info-value" id="infoUpper">16</div>
              </div>
              <div class="profile-info-group">
                <div class="profile-info-label">Lower Body Width (in)</div>
                <div class="profile-info-value" id="infoLower">18</div>
              </div>
            </div>
            <button class="edit-btn" id="editBtn">Edit</button>
          </div>

          <!-- Edit Form (Hidden by Default) -->
          <form class="profile-info-card edit-form" id="profileEdit" style="display:none;">
            <div class="profile-info-row">
              <div class="profile-info-group">
                <label>Full Name</label>
                <input type="text" id="editName" required>
              </div>
              <div class="profile-info-group">
                <label>Email</label>
                <input type="email" id="editEmail" required>
              </div>
              <div class="profile-info-group">
                <label>Phone</label>
                <input type="text" id="editPhone" required>
              </div>
              <div class="profile-info-group">
                <label>Gender</label>
                <select id="editGender">
                  <option value="Female">Female</option>
                  <option value="Male">Male</option>
                </select>
              </div>
              <!-- Skin Tone Picker -->
              <div class="profile-info-group">
                <label>
                  Skin Tone
                  <span style="font-size:0.99rem;font-weight:400;color:#888;">(or use Detect with Camera)</span>
                  <span class="help-icon">
                    i
                    <span class="help-tooltip">
                      Slide left/right to match your skin or use â€œDetect with Cameraâ€.
                      0 = very light, 100 = very deep. Choose what looks closest to your face in daylight.
                    </span>
                  </span>
                </label>
                <div class="skin-tone-row">
                  <span class="skin-preview" id="editSkinPreview"></span>
                  <input type="range" min="0" max="100" value="30" class="skin-slider" id="editSkinSlider" required>
                  <button type="button" class="camera-btn" id="editOpenCameraBtn">
                    <svg width="18" height="18" style="vertical-align:-3px;margin-right:3px" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <rect x="2" y="5" width="14" height="10" rx="2.5" stroke="#fff" stroke-width="2" fill="none"/>
                      <circle cx="9" cy="10" r="2.5" stroke="#fff" stroke-width="2" fill="none"/>
                      <rect x="7" y="3" width="4" height="2" rx="1" fill="#fff"/>
                    </svg>
                    Detect with Camera
                  </button>
                </div>
                <input type="hidden" id="editSkinToneColor" required>
              </div>
              <div class="profile-info-group">
                <label>
                  Age
                  <span class="help-icon">
                    i
                    <span class="help-tooltip">
                      Enter your current age in years. This helps us keep recommendations age-appropriate.
                    </span>
                  </span>
                </label>
                <input type="number" id="editAge" min="1" max="100">
              </div>
              <div class="profile-info-group">
                <label>
                  Weight (kg)
                  <span class="help-icon">
                    i
                    <span class="help-tooltip">
                      Enter your approximate weight in kilograms. It is used only to understand proportions, not for dieting.
                    </span>
                  </span>
                </label>
                <input type="number" id="editWeight" min="1" max="200">
              </div>
              <div class="profile-info-group">
                <label>
                  Body Length (in)
                  <span class="help-icon">
                    i
                    <span class="help-tooltip">
                      Measure from the top of your shoulder down to your ankle while standing straight.
                      Add the value in inches. This helps with dress/maxi length.
                    </span>
                  </span>
                </label>
                <input type="number" id="editLength" min="1" max="100">
              </div>
              <div class="profile-info-group">
                <label>
                  Upper Body Width (in)
                  <span class="help-icon">
                    i
                    <span class="help-tooltip">
                      Measure across the widest part of your shoulders (back side) in inches.
                      This is used to understand if your shoulders are broader or slimmer.
                    </span>
                  </span>
                </label>
                <input type="number" id="editUpper" min="1" max="100">
              </div>
              <div class="profile-info-group">
                <label>
                  Lower Body Width (in)
                  <span class="help-icon">
                    i
                    <span class="help-tooltip">
                      Measure across the widest part of your hips in inches.
                      Comparing this with your upper body tells us your body shape.
                    </span>
                  </span>
                </label>
                <input type="number" id="editLower" min="1" max="100">
              </div>
            </div>
            <div class="edit-actions">
              <button type="submit" class="edit-btn-save btn">Save</button>
              <button type="button" class="edit-btn-cancel btn" id="cancelEdit">Cancel</button>
            </div>
          </form>

          <!-- Analysis/Bar Chart -->
          <div class="profile-status-row">
            <div class="status-card" id="suitability-card">
              <div class="status-title">
                Style &amp; Color Suitability
                <span class="help-icon">
                  i
                  <span class="help-tooltip">
                    These percentages are calculated from your skin tone and body proportions.
                    They tell you how much lighter vs deeper shades and western vs eastern outfits suit you personally.
                  </span>
                </span>
              </div>
              <div style="display: flex; gap: 1.7rem; flex-wrap: wrap;">
                <div style="flex:1 1 170px; min-width:150px;">
                  <div class="progress-row">
                    <div class="progress-label">Lighter Tones</div>
                    <div class="progress-bar-bg">
                      <div class="progress-bar" style="width: 65%"></div>
                    </div>
                    <span class="bar-label">65%</span>
                  </div>
                  <div class="progress-row">
                    <div class="progress-label">Darker Tones</div>
                    <div class="progress-bar-bg">
                      <div class="progress-bar" style="width: 82%"></div>
                    </div>
                    <span class="bar-label">82%</span>
                  </div>
                </div>
                <div style="flex:1 1 170px; min-width:150px;">
                  <div class="progress-row">
                    <div class="progress-label">Western Wear</div>
                    <div class="progress-bar-bg">
                      <div class="progress-bar" style="width: 77%"></div>
                    </div>
                    <span class="bar-label">77%</span>
                  </div>
                  <div class="progress-row">
                    <div class="progress-label">Eastern Wear</div>
                    <div class="progress-bar-bg">
                      <div class="progress-bar" style="width: 60%"></div>
                    </div>
                    <span class="bar-label">60%</span>
                  </div>
                </div>
              </div>
              <div style="margin:1.2rem 0 .7rem 0;">
                <div style="font-weight:600; color:var(--accent); margin-bottom:0.4rem;">Your Color Palette</div>
                <div style="display:flex;gap:8px;">
                  <span class="color-swatch" style="background:#edc988;" title="Mustard"></span>
                  <span class="color-swatch" style="background:#d9c4b0;" title="Latte"></span>
                  <span class="color-swatch" style="background:#c7b199;" title="Nude"></span>
                  <span class="color-swatch" style="background:#9e866c;" title="Taupe"></span>
                  <span class="color-swatch" style="background:#f7d9c4;" title="Peach Nude"></span>
                </div>
              </div>
              <div style="display:flex;gap:1.3rem;align-items:center;margin-bottom:0.8rem;">
                <div><b style="color:#24b327;">Best:</b>
                  <span class="color-key">Nude Latte</span>
                </div>
                <div>
                  <b style="color:#ea2222;">Worst:</b>
                  <span class="worst-color">Neon Yellow</span>
                </div>
              </div>
            </div>

            <div class="status-card" id="personalized-analysis" style="background:linear-gradient(120deg,#f8f5f2 80%,#f3efe7 100%);">
              <div class="status-title" style="color:var(--accent);">Personalized Analysis</div>
              <div id="personalized-analysis-text">
                <ul style="margin:0 0 0 1em; padding:0;list-style:disc;line-height:1.68; font-size:1.08rem; color:#6a584a;">
                  <li><b style="color:#ad00e2;">Lighter shades</b> (white, beige, pastel peach, latte) look <b>elegant</b>, but too much white can sometimes wash out your complexion.</li>
                  <li><b class="color-key">Nude &amp; earthy tones</b> (taupe, mocha, latte, sand) enhance your natural warmth â€” these should be your daily go-to shades.</li>
                  <li><b style="color:#7d7058;">Western styles</b> suit you <b>more (77%)</b>, especially in nude or neutral hues.</li>
                  <li><b class="color-key">Eastern wear</b> also looks good <b>(60%)</b>, try statement dupatta, embroidery or contrast with medium tones.</li>
                  <li><span style="color:#ea2222;"><b>Avoid neon or extremely bright colors</b></span> (e.g. neon yellow, bright pink), as these can clash with your undertone.</li>
                </ul>
              </div>
              <div id="latest-recommendation"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Logout button row -->
      <div style="max-width:1100px; margin: 2rem auto 1rem auto; padding: 0 1rem; text-align: right;">
        <button class="logout-btn-bully" id="logoutBullyBtn" style="max-width: 160px; width: 100%;">
          Logout
        </button>
      </div>
    </section>
  </main>

  <!-- Custom Logout Confirmation Modal -->
  <div id="logoutConfirmModal" style="display:none;">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <h2>Confirm Logout</h2>
      <p>Are you sure you want to logout?</p>
      <div class="modal-actions">
        <button id="confirmLogoutBtn" class="btn confirm-btn">Yes, Logout</button>
        <button id="cancelLogoutBtn" class="btn cancel-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Camera Modal -->
  <div id="cameraModal" style="display:none;">
    <button id="closeCameraBtn">âœ–</button>
    <div class="modal-row">
      <!-- Left: Camera -->
      <div class="camera-col">
        <div class="camera-box-wrap">
          <video id="modalVideo" autoplay playsinline></video>
          <canvas id="cameraCanvas" width="320" height="380"></canvas>
          <div id="bigGuideCircle"></div>
        </div>
        <div class="camera-warning-under" id="cameraWarning">
          âš ï¸ For best results, use in natural daylight.<br>
          Avoid colored light and heavy shadows.
        </div>
        <button id="sampleSkinToneBtn">Sample Skin Tone</button>
      </div>
      <!-- Right: Results -->
      <div class="result-col">
        <h2 style="color:#a380ff;font-weight:800;font-size:2.1rem;letter-spacing:0.5px;">Skin Tone Detection</h2>
        <div class="detected-msg" id="detectedMsg" style="display:none;font-weight:700;font-size:1.18rem;">Yeah, I detected your skin! ðŸŽ‰</div>
        <div class="tone-preview-big" id="tonePreviewBig" style="display:none;"></div>
        <div class="tone-name" id="toneName" style="display:none;"></div>
        <button class="use-tone-btn" id="useSkinToneBtn" style="display:none;">Use This Skin Tone</button>
        <button class="use-tone-btn" id="tryAgainBtn" style="display:none;margin-left:10px;">Try Again</button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="footer-main">
      <div class="footer-col">
        <div style="font-weight:700; margin-bottom:0.7rem;">Need help?</div>
        <div style="margin-bottom:0.4rem;"><a href="contactus.html">Contact us</a></div>
      </div>
      <div class="footer-col">
        <div style="font-weight:700; margin-bottom:0.7rem;">More info</div>
        <div style="margin-bottom:0.4rem;"><a href="aboutus.html">About us</a></div>
        <div style="margin-bottom:0.4rem;"><a href="terms.html">Terms &amp; Conditions</a></div>
      </div>
      <div class="footer-col">
        <div style="font-weight:700; margin-bottom:0.7rem;">Location</div>
        <div style="margin-bottom:0.4rem;"><a href="mailto:support@PaletteandFit.com">support@PaletteandFit.com</a></div>
        <div style="margin-bottom:0.4rem;">
          <a href="https://www.google.com/maps?q=4162+Wayback+Lane,+Farmingdale,+New+York,+11735,+USA" target="_blank" rel="noopener">
            4162 Wayback Lane, Farmingdale
          </a>
        </div>
        <div style="margin-bottom:0.4rem;">New York, 11735, USA</div>
      </div>
    </div>
    <div style="text-align:center; margin-top:2.5rem; font-size:1.05rem;">
      <strong>Palette and Fit</strong><br>
      <span style="font-size:0.9rem; color:#bbb;">Â© 2025 Palette and Fit. All rights reserved.</span>
    </div>
  </footer>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    /* ðŸ” Protect this page: only logged in users can see it */
    const storedEmail =
      localStorage.getItem('pf_user_email') || localStorage.getItem('user_email');

    if (!storedEmail) {
      window.location.href = 'guest-home.html';
      return;
    }

    /* ðŸ”— BACKEND BASE URL (Render) */
    const API_BASE = "https://palette-and-fit-backend.onrender.com";
    const GET_PROFILE_ENDPOINT = API_BASE + "/api/get_profile";
    const SAVE_PROFILE_ENDPOINT = API_BASE + "/api/profile";

    /* ========== HEADER / DRAWER / DARK MODE (same as men/homepage1) ========== */
    const hamburgerUser   = document.getElementById('navToggleUser');
    const drawerUser      = document.getElementById('navDrawerUser');
    const backdropUser    = document.getElementById('navBackdropUser');
    const drawerCloseUser = document.getElementById('drawerCloseUser');

    const dmBtnHeaderUser = document.getElementById('darkModeToggleUser');
    const dmBtnDrawerUser = document.getElementById('drawerDarkToggleUser');

    const profileToggleUser = document.getElementById('profileToggleUser');
    const profileMenuUser   = document.getElementById('profileMenuUser');

    /* Logo click -> logged-in home */
    const logo = document.querySelector('.logo');
    if (logo) {
      logo.addEventListener('click', () => {
        window.location.href = 'homepage1.html';
      });
    }

    function openDrawerUser() {
      drawerUser.classList.add('open');
      backdropUser.classList.add('open');
      hamburgerUser.classList.add('is-active');
      hamburgerUser.setAttribute('aria-expanded', 'true');
      drawerUser.setAttribute('aria-hidden', 'false');
    }
    function closeDrawerUser() {
      drawerUser.classList.remove('open');
      backdropUser.classList.remove('open');
      hamburgerUser.classList.remove('is-active');
      hamburgerUser.setAttribute('aria-expanded', 'false');
      drawerUser.setAttribute('aria-hidden', 'true');
    }

    if (hamburgerUser && drawerUser && backdropUser) {
      hamburgerUser.addEventListener('click', () => {
        if (drawerUser.classList.contains('open')) {
          closeDrawerUser();
        } else {
          openDrawerUser();
        }
      });

      backdropUser.addEventListener('click', closeDrawerUser);
      if (drawerCloseUser) drawerCloseUser.addEventListener('click', closeDrawerUser);

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && drawerUser.classList.contains('open')) {
          closeDrawerUser();
        }
      });
    }

    /* Drawer "Shop" accordion */
    document.querySelectorAll('.drawer-group-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const group = btn.closest('.drawer-group');
        if (!group) return;
        group.classList.toggle('open');
      });
    });

    /* Dark mode shared */
    function setDarkMode(dark) {
      document.body.classList.toggle('dark-mode', dark);
      localStorage.setItem('darkMode', dark ? 'true' : 'false');

      [dmBtnHeaderUser, dmBtnDrawerUser].forEach(btn => {
        if (!btn) return;
        btn.setAttribute('aria-pressed', String(dark));
        const icon = btn.querySelector('.dm-icon');
        const text = btn.querySelector('.dm-text');
        if (icon) icon.textContent = dark ? 'â˜€ï¸' : 'ðŸŒ™';
        if (text) text.textContent = dark ? 'Light Mode' : 'Dark Mode';
      });
    }

    const initialDark = localStorage.getItem('darkMode') === 'true';
    setDarkMode(initialDark);

    [dmBtnHeaderUser, dmBtnDrawerUser].forEach(btn => {
      if (!btn) return;
      btn.addEventListener('click', () => {
        const dark = !document.body.classList.contains('dark-mode');
        setDarkMode(dark);
      });
    });

    // Profile dropdown (desktop)
    if (profileToggleUser && profileMenuUser) {
      function closeProfileMenuUser() {
        profileMenuUser.classList.remove('open');
        profileToggleUser.setAttribute('aria-expanded', 'false');
      }
      function openProfileMenuUser() {
        profileMenuUser.classList.add('open');
        profileToggleUser.setAttribute('aria-expanded', 'true');
      }

      profileToggleUser.addEventListener('click', (e) => {
        e.stopPropagation();
        if (profileMenuUser.classList.contains('open')) {
          closeProfileMenuUser();
        } else {
          openProfileMenuUser();
        }
      });

      document.addEventListener('click', (e) => {
        if (!profileMenuUser.contains(e.target) && e.target !== profileToggleUser) {
          closeProfileMenuUser();
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeProfileMenuUser();
        }
      });
    }

    /* ========== LOGOUT MODAL (shared for header, drawer, big button) ========== */
    const logoutModal = document.getElementById('logoutConfirmModal');
    const confirmLogoutBtn = document.getElementById('confirmLogoutBtn');
    const cancelLogoutBtn = document.getElementById('cancelLogoutBtn');
    const logoutBtn = document.getElementById('logoutBullyBtn');

    function openLogoutModal() {
      if (logoutModal) logoutModal.style.display = 'block';
    }
    function closeLogoutModal() {
      if (logoutModal) logoutModal.style.display = 'none';
    }
    function performLogout() {
      // ðŸ”‘ Clear BOTH possible keys and related profile data
      localStorage.removeItem('pf_user_email');
      localStorage.removeItem('user_email');
      localStorage.removeItem('auth_token');
      localStorage.removeItem('profileData');
      localStorage.removeItem('pf_suggestion_profile');
      localStorage.removeItem('darkMode');
      closeLogoutModal();
      window.location.href = 'guest-home.html';
    }

    if (logoutModal && confirmLogoutBtn && cancelLogoutBtn) {
      if (logoutBtn) {
        logoutBtn.addEventListener('click', openLogoutModal);
      }
      cancelLogoutBtn.addEventListener('click', closeLogoutModal);
      const modalOverlay = logoutModal.querySelector('.modal-overlay');
      modalOverlay && modalOverlay.addEventListener('click', closeLogoutModal);

      confirmLogoutBtn.addEventListener('click', performLogout);
    }

    // header + drawer "Log out" links open same modal
    const logoutLinks = document.querySelectorAll('.logout-link');
    logoutLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        openLogoutModal();
      });
    });

    /* ========== SKIN TONE / PROFILE JS ========== */
    const SKIN_TONES = [
      { name: "Porcelain",     hex: "#fff0dc" },
      { name: "Ivory",         hex: "#ffe7c7" },
      { name: "Fair",          hex: "#fde1c8" },
      { name: "Light Beige",   hex: "#ffe2b0" },
      { name: "Rosy Beige",    hex: "#ffe3dd" },
      { name: "Vanilla",       hex: "#f8e4c2" },
      { name: "Peach",         hex: "#ffe0b3" },
      { name: "Almond",        hex: "#f7d9c4" },
      { name: "Light",         hex: "#fbd2a7" },
      { name: "Sand",          hex: "#fae0bb" },
      { name: "Honey",         hex: "#f1c27d" },
      { name: "Wheatish",      hex: "#eac086" },
      { name: "Golden",        hex: "#e6a86c" },
      { name: "Olive",         hex: "#c49e7b" },
      { name: "Warm Beige",    hex: "#f5c185" },
      { name: "Tan",           hex: "#b98c6b" },
      { name: "Caramel",       hex: "#de9e53" },
      { name: "Medium Brown",  hex: "#a97856" },
      { name: "Chestnut",      hex: "#ad7d4c" },
      { name: "Dusky",         hex: "#704214" },
      { name: "Copper",        hex: "#b47838" },
      { name: "Deep",          hex: "#8d5524" },
      { name: "Rich",          hex: "#6d4217" },
      { name: "Mocha",         hex: "#56351e" }
    ];

    const profileDefaults = {
      name: "Ayesha Khan", email: "ayesha@email.com", phone: "0301-1234567",
      gender: "Female", skin_tone: "Wheatish", age: 24, weight: 58,
      body_length: 60, upper_width: 16, lower_width: 18,
      pic: "https://cdn.vectorstock.com/i/1000v/54/41/young-and-elegant-woman-avatar-profile-vector-9685441.jpg"
    };

    const getSkinColor = (v) => {
      const idx = Math.round(v * (SKIN_TONES.length - 1) / 100);
      return SKIN_TONES[Math.max(0, Math.min(idx, SKIN_TONES.length - 1))].hex;
    };
    const getToneName = (v) => {
      const idx = Math.round(v * (SKIN_TONES.length - 1) / 100);
      return SKIN_TONES[Math.max(0, Math.min(idx, SKIN_TONES.length - 1))].name;
    };
    const normGender = (g) => {
      const x = String(g||'').trim().toLowerCase();
      if (x.startsWith('m')) return 'Male';
      if (x.startsWith('f')) return 'Female';
      if (['male','female','other'].includes(x)) return x[0].toUpperCase() + x.slice(1);
      return 'Other';
    };

    function computeBodyShape(data) {
      const upper = Number(data.upper_width) || 0;
      const lower = Number(data.lower_width) || 0;
      if (!upper || !lower) return "balanced";
      const ratio = lower / upper;
      if (ratio > 1.15) return "pear";
      if (ratio < 0.85) return "inverted";
      return "hourglass";
    }

    function computeAnalysisFromProfile(data) {
      const toneName = String(data.skin_tone || '').toLowerCase();
      let toneIndex = SKIN_TONES.findIndex(t => t.name.toLowerCase() === toneName);
      if (toneIndex < 0) toneIndex = Math.round(SKIN_TONES.length / 2);
      const toneLevel = toneIndex / (SKIN_TONES.length - 1); // 0 = very light, 1 = very deep

      const shape = computeBodyShape(data);
      const weight = Number(data.weight) || 0;
      const bodyLengthIn = Number(data.body_length) || 0;
      const heightMeters = bodyLengthIn ? (bodyLengthIn * 2.54) / 100 : 0;
      const bmiApprox = heightMeters ? (weight / (heightMeters * heightMeters)) : null;
      const gender = normGender(data.gender);

      // Light vs dark percentages
      let lighter = Math.round(70 + (0.4 * (0.5 - toneLevel) * 100));
      lighter = Math.max(30, Math.min(93, lighter));
      let darker = Math.round(100 - lighter + (toneLevel > 0.5 ? 5 : -5));
      darker = Math.max(35, Math.min(95, darker));

      // Western vs eastern based on shape + bmi
      let western = 70;
      if (shape === "pear") western = 65;
      else if (shape === "inverted") western = 76;
      else if (shape === "hourglass") western = 72;

      if (bmiApprox) {
        if (bmiApprox < 19) western += 4;
        else if (bmiApprox > 27) western -= 4;
      }
      western = Math.max(45, Math.min(88, western));
      let eastern = Math.max(45, Math.min(88, 110 - western));

      // Gender-based tweak
      if (gender === "Male") {
        western = Math.min(90, western + 5);
        eastern = Math.max(45, Math.min(88, 110 - western));
      } else if (gender === "Female") {
        eastern = Math.min(90, eastern + 5);
        western = Math.max(45, Math.min(88, 110 - eastern));
      }

      let palette, bestColorName, worstColorName, colorWords;
      if (toneLevel <= 0.33) {
        palette = ["#ffe3dd","#fde1c8","#f8e4c2","#ffe7c7","#f7d9c4"];
        bestColorName = "Soft pastels & blush nudes";
        worstColorName = "Harsh neons & very dark maroons";
        colorWords = "soft peach, blush pink, light beige and oatmeal nudes";
      } else if (toneLevel <= 0.66) {
        palette = ["#f7d9c4","#f1c27d","#eac086","#f5c185","#c7b199"];
        bestColorName = "Warm nudes & earthy browns";
        worstColorName = "Cool icy blues & neon yellow";
        colorWords = "warm latte, camel, caramel, muted terracotta and olive";
      } else {
        palette = ["#b98c6b","#ad7d4c","#8d5524","#704214","#56351e"];
        bestColorName = "Rich jewel tones & deep neutrals";
        worstColorName = "Very pale pastels & light greys";
        colorWords = "emerald, deep teal, plum, espresso brown and copper";
      }

      const faceItems = gender === "Male"
        ? "shirts, t-shirts and upper layers"
        : "tops, hijabs/dupatta and outerwear";

      const tips =
        `Your skin tone sits in the ${toneLevel < 0.33 ? "light" : toneLevel < 0.66 ? "medium-warm" : "deep"} range ` +
        `and your body is closer to a ${shape === "pear" ? "pear (more volume on hips)" :
          shape === "inverted" ? "broad-shouldered / inverted triangle" : "more balanced / hourglass"} shape.\n\n` +
        `Lighter shades look around ${lighter}% flattering on you, while deeper shades are close to ${darker}%. ` +
        `Western silhouettes score about ${western}% on your frame and eastern styles about ${eastern}%.\n\n` +
        `Stay close to ${colorWords} in your ${faceItems}. ` +
        `Keep ${worstColorName.toLowerCase()} away from your face area so your undertone stays fresh and bright.`;

      return {
        bars: { light: lighter, dark: darker, west: western, east: eastern },
        palette,
        best: bestColorName,
        worst: worstColorName,
        tips,
        shape
      };
    }

    function mdToHtml(md) {
      return String(md || "")
        .replace(/\*\*(.*?)\*\*/g,'<b>$1</b>')
        .replace(/\*(.*?)\*/g,'<i>$1</i>')
        .replace(/\n/g,'<br>');
    }

    function createAnalysisHTML(data, analysis) {
      const bars = analysis.bars || { light: 0, dark: 0, west: 0, east: 0 };
      const shape = analysis.shape || computeBodyShape(data);
      const shapeLabel =
        shape === "pear" ? "Pear (wider hips than shoulders)" :
        shape === "inverted" ? "Inverted triangle (broader shoulders)" :
        "More balanced / hourglass";

      const gender = normGender(data.gender);
      const westernExamples = gender === "Male"
        ? "shirts, jeans, chinos, t-shirts, hoodies"
        : "jeans, shirts, blazers, dresses";
      const easternExamples = gender === "Male"
        ? "shalwar kameez, kurta pajama, waistcoat sets"
        : "shalwar suits, abayas, maxi kurtas";

      const faceAreaItems = gender === "Male"
        ? "shirts, t-shirts and upper layers"
        : "tops, hijabs, dupattas and scarves";

      return `
        <ul style="margin:0 0 0 1em; padding:0;list-style:disc;line-height:1.68; font-size:1.05rem; color:#6a584a;">
          <li><b style="color:#ad00e2;">Body shape:</b> ${shapeLabel} â€“ outfits that balance your upper and lower body will look most put-together.</li>
          <li><b>Lighter vs deeper shades:</b> lighter colours (white, beige, peach, latte) suit you about <b>${bars.light}%</b>,
              while deeper tones (mocha, rust, espresso, deep jewel tones) are around <b>${bars.dark}%</b>.</li>
          <li><b>Western vs eastern styles:</b> western silhouettes (${westernExamples}) are roughly <b>${bars.west}%</b> flattering,
              and eastern styles (${easternExamples}) sit around <b>${bars.east}%</b> for your frame.</li>
          <li><b>Best around your face:</b> stay close to <span class="color-key">${analysis.best}</span> for ${faceAreaItems} â€“
              they brighten your skin more than others.</li>
          <li><b>Avoid near the face:</b> <span class="worst-color">${analysis.worst}</span> can fight with your undertone,
              so keep them for bags, shoes or prints away from the face.</li>
        </ul>
      `;
    }

    function syncSuggestionProfile(data, analysis) {
      const payload = {
        email: data.email,
        name: data.name,
        gender: normGender(data.gender),
        skin_tone: data.skin_tone,
        body_length: data.body_length,
        upper_width: data.upper_width,
        lower_width: data.lower_width,
        body_shape: analysis.shape || computeBodyShape(data),
        palette: analysis.palette,
        best_color: analysis.best,
        worst_color: analysis.worst,
        bars: analysis.bars
      };
      localStorage.setItem('pf_suggestion_profile', JSON.stringify(payload));
    }

    async function loadProfile() {
      const email =
        storedEmail ||
        localStorage.getItem('pf_user_email') ||
        localStorage.getItem('user_email');

      if (!email) {
        window.location.href = "guest-home.html";
        return;
      }

      const signupPhone  = localStorage.getItem('signupPhone')  || '';
      const signupGender = localStorage.getItem('signupGender') || '';

      try {
        const resp = await fetch(GET_PROFILE_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email })
        });

        if (resp.ok) {
          const data = await resp.json();

          data.phone  = data.phone  || signupPhone;
          data.gender = normGender(data.gender || signupGender || profileDefaults.gender);

          setProfileUI(data);
          setDynamicAnalysis(data);

          localStorage.setItem('profileData', JSON.stringify(data));
        } else {
          const cached = JSON.parse(localStorage.getItem('profileData') || '{}');
          if (Object.keys(cached).length) {
            setProfileUI(cached);
            setDynamicAnalysis(cached);
          } else {
            const error = await resp.json();
            alert(error.error || "Could not fetch profile");
          }
        }
      } catch {
        const cached = JSON.parse(localStorage.getItem('profileData') || '{}');
        if (Object.keys(cached).length) {
          setProfileUI(cached);
          setDynamicAnalysis(cached);
        } else {
          alert("Failed to load profile.");
        }
      }
    }

    function setProfileUI(d) {
      const data = { ...profileDefaults, ...d };

      data.gender = normGender(data.gender || profileDefaults.gender);
      data.phone  = data.phone || localStorage.getItem('signupPhone') || profileDefaults.phone;

      document.getElementById("profileName").textContent  = data.name;
      document.getElementById("profileEmail").textContent = data.email;
      document.getElementById("profilePhone").textContent = data.phone;
      document.getElementById("profileAge").textContent   = data.age;
      document.getElementById("profilePic").src           = data.pic || profileDefaults.pic;

      document.getElementById("infoName").textContent   = data.name;
      document.getElementById("infoEmail").textContent  = data.email;
      document.getElementById("infoPhone").textContent  = data.phone;
      document.getElementById("infoGender").textContent = data.gender;

      const toneObj = SKIN_TONES.find(
        t => t.name.toLowerCase() === String(data.skin_tone||'').toLowerCase()
      );
      document.getElementById("skinToneDot").style.background = toneObj ? toneObj.hex : "#eac086";
      document.getElementById("skinToneName").textContent     =
        toneObj ? toneObj.name : (data.skin_tone || "Unknown");

      document.getElementById("infoAge").textContent    = data.age;
      document.getElementById("infoWeight").textContent = data.weight;
      document.getElementById("infoLength").textContent = data.body_length;
      document.getElementById("infoUpper").textContent  = data.upper_width;
      document.getElementById("infoLower").textContent  = data.lower_width;

      if (!data.pic || data.pic === profileDefaults.pic) {
        document.getElementById("profilePic").src =
          data.gender === "Male"
            ? "https://cdn-icons-png.flaticon.com/512/2922/2922510.png"
            : profileDefaults.pic;
      }
    }

    function setDynamicAnalysis(data) {
      const baseAnalysis = computeAnalysisFromProfile(data);

      const barsFromServer =
        typeof data.light_tones_percent === "number" &&
        typeof data.dark_tones_percent  === "number" &&
        typeof data.western_percent     === "number" &&
        typeof data.eastern_percent     === "number";

      const analysis = {
        bars: barsFromServer ? {
          light: data.light_tones_percent,
          dark:  data.dark_tones_percent,
          west:  data.western_percent,
          east:  data.eastern_percent
        } : baseAnalysis.bars,
        palette: (data.palette && data.palette.length) ? data.palette : baseAnalysis.palette,
        best: data.best_color || baseAnalysis.best,
        worst: data.worst_color || baseAnalysis.worst,
        tips: data.personalized_analysis || baseAnalysis.tips,
        shape: baseAnalysis.shape
      };

      // If palette from API is color names, map to hex
      if (analysis.palette && analysis.palette.length && typeof analysis.palette[0] === "string" && !analysis.palette[0].startsWith("#")) {
        analysis.palette = analysis.palette.map(name => {
          const found = SKIN_TONES.find(
            t => t.name.toLowerCase() === String(name).toLowerCase()
          );
          return found ? found.hex : "#ccc";
        });
      }

      const card = document.getElementById('suitability-card');
      if (card) {
        const rows = card.querySelectorAll(".progress-row");
        if (rows.length >= 4) {
          rows[0].querySelector(".progress-bar").style.width = analysis.bars.light + "%";
          rows[0].querySelector(".bar-label").textContent    = analysis.bars.light + "%";

          rows[1].querySelector(".progress-bar").style.width = analysis.bars.dark + "%";
          rows[1].querySelector(".bar-label").textContent    = analysis.bars.dark + "%";

          rows[2].querySelector(".progress-bar").style.width = analysis.bars.west + "%";
          rows[2].querySelector(".bar-label").textContent    = analysis.bars.west + "%";

          rows[3].querySelector(".progress-bar").style.width = analysis.bars.east + "%";
          rows[3].querySelector(".bar-label").textContent    = analysis.bars.east + "%";
        }

        const paletteContainer = card.querySelector(".color-swatch")?.parentElement;
        if (paletteContainer && analysis.palette && analysis.palette.length) {
          paletteContainer.innerHTML = analysis.palette
            .map(c => `<span class="color-swatch" style="background:${c};"></span>`)
            .join("");
        }

        const bestElem  = card.querySelector(".color-key");
        const worstElem = card.querySelector(".worst-color");
        if (bestElem)  bestElem.textContent  = analysis.best  || "-";
        if (worstElem) worstElem.textContent = analysis.worst || "-";
      }

      const paText = document.getElementById('personalized-analysis-text');
      if (paText) {
        paText.innerHTML = createAnalysisHTML(data, analysis);
      }

      const latestBox = document.getElementById('latest-recommendation');
      if (latestBox) {
        latestBox.innerHTML = "";
        const tipText = data.last_recommendation || analysis.tips;
        if (tipText) {
          latestBox.innerHTML =
            `<h3 style="margin-top:0.9rem;margin-bottom:0.3rem;">Latest AI Fashion Tip:</h3>
             <div class="recommendation-box">${mdToHtml(tipText)}</div>`;
        }
      }

      // Sync for Suggestion page
      syncSuggestionProfile(data, analysis);
    }

    // anti-jitter label CSS
    (function ensureToneLabelCSS(){
      if (document.getElementById('tone-label-css')) return;
      const st = document.createElement('style');
      st.id = 'tone-label-css';
      st.textContent = `
        .tone-name-fixed{display:inline-block;width:140px;min-width:140px;margin-left:12px;
          font-weight:600;color:#ad00e2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        @media (max-width:700px){.tone-name-fixed{width:110px;min-width:110px}}
      `;
      document.head.appendChild(st);
    })();

    const skinSlider = document.getElementById("editSkinSlider");
    const setEditSliderGradient = () => {
      if (!skinSlider) return;
      const stops = SKIN_TONES.map((t, i) =>
        `${t.hex} ${Math.round((i*100)/(SKIN_TONES.length-1))}%`
      ).join(', ');
      skinSlider.style.background = `linear-gradient(90deg, ${stops})`;
    };
    setEditSliderGradient();

    function updateToneSlider(val) {
      const v = parseInt(val || '0', 10);
      const idx = Math.round(v * (SKIN_TONES.length - 1) / 100);
      const tone = SKIN_TONES[Math.max(0, Math.min(idx, SKIN_TONES.length - 1))];

      const preview = document.getElementById("editSkinPreview");
      if (preview) {
        preview.style.background = tone.hex;
        preview.setAttribute('title', tone.name);
        let live = document.getElementById('editToneLiveName');
        if (!live) {
          live = document.createElement('span');
          live.id = 'editToneLiveName';
          live.className = 'tone-name-fixed';
          preview.after(live);
        }
        live.textContent = tone.name;
      }
      const hidden = document.getElementById("editSkinToneColor");
      if (hidden) hidden.value = tone.name;
    }

    if (skinSlider) {
      skinSlider.addEventListener('input', function () {
        updateToneSlider(this.value);
      });
    }

    document.getElementById("editBtn").onclick = function () {
      const d = JSON.parse(localStorage.getItem('profileData')) || profileDefaults;

      document.getElementById("editName").value   = d.name;
      document.getElementById("editEmail").value  = d.email;
      document.getElementById("editPhone").value  =
        d.phone || localStorage.getItem('signupPhone') || '';
      document.getElementById("editGender").value = normGender(d.gender);
      document.getElementById("editAge").value    = d.age;
      document.getElementById("editWeight").value = d.weight;
      document.getElementById("editLength").value = d.body_length;
      document.getElementById("editUpper").value  = d.upper_width;
      document.getElementById("editLower").value  = d.lower_width;

      let idx = SKIN_TONES.findIndex(
        t => t.name.toLowerCase() === String(d.skin_tone||'').toLowerCase()
      );
      if (idx < 0) idx = 5;
      skinSlider.value = Math.round(idx * 100 / (SKIN_TONES.length - 1));
      updateToneSlider(skinSlider.value);

      document.getElementById("profileView").style.display = "none";
      document.getElementById("profileEdit").style.display = "block";
    };

    document.getElementById("cancelEdit").onclick = function () {
      document.getElementById("profileEdit").style.display = "none";
      document.getElementById("profileView").style.display = "block";
    };

    document.getElementById("profileEdit").onsubmit = async function (e) {
      e.preventDefault();
      const email =
        storedEmail ||
        localStorage.getItem('pf_user_email') ||
        localStorage.getItem('user_email');
      if (!email) { alert("No user!"); return; }

      const newData = {
        email,
        name: document.getElementById("editName").value,
        phone: document.getElementById("editPhone").value,
        gender: normGender(document.getElementById("editGender").value),
        skin_tone: document.getElementById("editSkinToneColor").value,
        age: +document.getElementById("editAge").value,
        weight: +document.getElementById("editWeight").value,
        body_length: +document.getElementById("editLength").value,
        upper_width: +document.getElementById("editUpper").value,
        lower_width: +document.getElementById("editLower").value
      };

      try {
        await fetch(SAVE_PROFILE_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(newData)
        });

        const merged = { ...newData, pic: document.getElementById("profilePic").src };
        localStorage.setItem('profileData', JSON.stringify(merged));
        await loadProfile();

        document.getElementById("profileEdit").style.display = "none";
        document.getElementById("profileView").style.display = "block";
      } catch {
        alert("Failed to save profile");
      }
    };

    const fileInput = document.getElementById('fileInput');
    if (fileInput) {
      fileInput.addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById("profilePic").src = e.target.result;
          const d = JSON.parse(localStorage.getItem('profileData')) || profileDefaults;
          d.pic = e.target.result;
          localStorage.setItem('profileData', JSON.stringify(d));
        };
        reader.readAsDataURL(file);
      });
    }

    const genderInput = document.getElementById('editGender');
    genderInput && genderInput.addEventListener('change', function () {
      if (normGender(this.value) === "Male") {
        document.getElementById("profilePic").src =
          "https://cdn-icons-png.flaticon.com/512/2922/2922510.png";
      } else {
        document.getElementById("profilePic").src = profileDefaults.pic;
      }
    });

    /* ========== CAMERA ========== */
    const editOpenCameraBtn = document.getElementById('editOpenCameraBtn');
    const cameraModal = document.getElementById('cameraModal');
    const closeCameraBtn = document.getElementById('closeCameraBtn');
    const modalVideo = document.getElementById('modalVideo');
    const cameraCanvas = document.getElementById('cameraCanvas');
    const sampleBtn = document.getElementById('sampleSkinToneBtn');
    const useSkinBtn = document.getElementById('useSkinToneBtn');
    const detectedMsg = document.getElementById('detectedMsg');
    const tonePreviewBig = document.getElementById('tonePreviewBig');
    const toneNameEl = document.getElementById('toneName');
    const tryAgainBtn = document.getElementById('tryAgainBtn');
    let stream = null, sampledSliderValue = null;

    function drawVideoFrame() {
      if (!cameraModal || cameraModal.style.display !== 'flex') return;
      const ctx = cameraCanvas.getContext('2d');
      ctx.drawImage(modalVideo, 0, 0, cameraCanvas.width, cameraCanvas.height);
      requestAnimationFrame(drawVideoFrame);
    }
    function closeModal() {
      cameraModal.style.display = 'none';
      if (stream) { stream.getTracks().forEach(t => t.stop()); stream = null; }
      modalVideo.srcObject = null;
    }

    if (editOpenCameraBtn && cameraModal && closeCameraBtn && modalVideo && cameraCanvas && sampleBtn && useSkinBtn && detectedMsg && tonePreviewBig && toneNameEl && tryAgainBtn) {
      editOpenCameraBtn.addEventListener('click', async () => {
        cameraModal.style.display = 'flex';
        try {
          stream = await navigator.mediaDevices.getUserMedia({ video: true });
          modalVideo.srcObject = stream;
          await modalVideo.play();
        } catch {
          alert('Camera permission required');
          cameraModal.style.display = 'none';
          return;
        }
        [detectedMsg, tonePreviewBig, toneNameEl, useSkinBtn, tryAgainBtn].forEach(el => el && (el.style.display = 'none'));
        sampledSliderValue = null;
        drawVideoFrame();
      });

      closeCameraBtn.addEventListener('click', closeModal);
      cameraModal.addEventListener('click', (e) => { if (e.target === cameraModal) closeModal(); });

      sampleBtn.addEventListener('click', () => {
        const ctx = cameraCanvas.getContext('2d');
        const W = cameraCanvas.width, H = cameraCanvas.height;
        const box = 50, cx = Math.floor(W / 2), cy = Math.floor(H / 2);
        const sx = Math.max(0, cx - box / 2), sy = Math.max(0, cy - box / 2);
        const imgData = ctx.getImageData(sx, sy, box, box);

        let total = [0, 0, 0], count = 0;
        for (let i = 0; i < imgData.data.length; i += 4) {
          total[0] += imgData.data[i];
          total[1] += imgData.data[i + 1];
          total[2] += imgData.data[i + 2];
          count++;
        }
        if (!count) return;

        const avg = total.map(x => Math.round(x / count));
        let bestVal = 0, bestDiff = Infinity;
        for (let v = 0; v <= 100; v++) {
          const c = getSkinColor(v);
          const rgb = [
            parseInt(c.slice(1, 3), 16),
            parseInt(c.slice(3, 5), 16),
            parseInt(c.slice(5, 7), 16)
          ];
          const diff = Math.hypot(
            rgb[0] - avg[0],
            rgb[1] - avg[1],
            rgb[2] - avg[2]
          );
          if (diff < bestDiff) { bestDiff = diff; bestVal = v; }
        }

        sampledSliderValue = bestVal;
        detectedMsg.style.display = '';
        tonePreviewBig.style.display = '';
        tonePreviewBig.style.background = getSkinColor(bestVal);
        toneNameEl.style.display = '';
        toneNameEl.textContent = `This is your skin tone: ${getToneName(bestVal)}`;
        useSkinBtn.style.display = '';
        tryAgainBtn.style.display = '';
        useSkinBtn.disabled = false;
      });

      useSkinBtn.addEventListener('click', () => {
        document.getElementById("editSkinPreview").style.background =
          getSkinColor(sampledSliderValue);
        document.getElementById("editSkinToneColor").value =
          getToneName(sampledSliderValue);
        document.getElementById("editSkinPreview").setAttribute(
          'title',
          getToneName(sampledSliderValue)
        );
        document.getElementById("editSkinSlider").value = sampledSliderValue;
        updateToneSlider(sampledSliderValue);
        closeModal();
      });

      tryAgainBtn.addEventListener('click', () => {
        [detectedMsg, tonePreviewBig, toneNameEl, useSkinBtn, tryAgainBtn].forEach(
          el => el && (el.style.display = 'none')
        );
        sampledSliderValue = null;
      });
    }

    /* INIT */
    loadProfile();
  });
</script>

</body>
</html>

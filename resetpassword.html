<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Password ‚Äì Palette and Fit</title>
  <link href="https://fonts.googleapis.com/css2?family=Style+Script&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --accent: #ad00e2;
      --btn-gradient: linear-gradient(90deg,#b77ffb 0%, #ad00e2 100%);
      --btn-gradient-hover: linear-gradient(90deg,#ad00e2 15%, #47238f 100%);
      --glass-bg-dark: rgba(34,18,41,0.86);
      --glass-bg-light: rgba(255,255,255,0.95);
      --glass-border: rgba(255,255,255,0.19);
      --input-bg-dark: rgba(255,255,255,0.10);
      --input-bg-light: rgba(180,158,214,0.14);
      --input-border: #c3b1e6;
      --text-dark: #fff;
      --text-light: #170826;
      --label-dark: #e1c7fa;
      --label-light: #6d3886;
      --box-shadow: 0 8px 38px 0 rgba(31,38,135,0.19);

      /* watercolor background */
      --custom-bg: url('data:image/jpeg;base64,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');
    }

    /* base layout */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      color: var(--text-dark);
      background: none !important;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: var(--custom-bg) center center/cover no-repeat fixed;
      z-index: -2;
      transition: filter 0.3s;
    }
    body:not(.light-mode)::before {
      filter: brightness(0.63) contrast(1.05) saturate(1.12);
    }

    /* center card with margins */
    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      padding: 4rem 1.2rem 2.6rem;
    }

    /* toggle */
    .mode-toggle {
      position: fixed;
      top: 24px;
      right: 28px;
      z-index: 10;
      background: var(--glass-bg-dark);
      border-radius: 22px;
      border: 1.5px solid var(--glass-border);
      box-shadow: 0 1px 8px rgba(122,45,246,0.11);
      padding: 7px 19px 7px 14px;
      color: #fff;
      font-size: 1.05rem;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    body.light-mode .mode-toggle {
      background: var(--glass-bg-light);
      color: #ad00e2;
    }
    .mode-toggle input{display:none}
    .mode-toggle span{font-size:1.22rem;margin-left:2px;}

    /* reset box */
    .reset-box {
      z-index: 2;
      width: 430px;
      max-width: 100%;
      background: var(--glass-bg-light);
      border-radius: 30px;
      border: 1.5px solid var(--glass-border);
      box-shadow: var(--box-shadow);
      padding: 2.4rem 2.4rem 1.7rem;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      backdrop-filter: blur(14px);
    }
    body:not(.light-mode) .reset-box{
      background:var(--glass-bg-dark);
      color:var(--text-dark);
    }

    .brand-heading{
      display:flex;
      justify-content:center;
      margin-bottom:0.25rem;
    }
    .brand-text{
      font-family:'Style Script',cursive;
      font-size:2.3rem;
      letter-spacing:1.8px;
      color:var(--accent);
      text-shadow:0 2px 8px rgba(173,0,226,0.35);
    }
    .reset-box h2{
      text-align:center;
      font-size:1.4rem;
      margin:0.4rem 0 0.3rem 0;
      color:#5b3b8e;
    }
    body:not(.light-mode) .reset-box h2{color:#f4e8ff;}
    .reset-box p{
      text-align:center;
      color:#6b3fa0;
      margin-bottom:1.1rem;
      font-size:0.98rem;
      letter-spacing:0.04em;
    }
    body:not(.light-mode) .reset-box p{color:#e0d2fa;}

    /* steps */
    .steps-indicator{
      display:flex;
      justify-content:center;
      gap:2.6rem;
      margin:0.2rem 0 1.4rem;
      font-size:0.86rem;
      color:#977ad3;
      position:relative;
    }
    .steps-indicator::before{
      content:"";
      position:absolute;
      top:0.6rem;
      left:12%;
      right:12%;
      height:2px;
      background:rgba(209,190,246,0.7);
      z-index:-1;
    }
    .step-dot{
      flex:0 0 auto;
      text-align:center;
      position:relative;
      padding-top:1.6rem;
      min-width:70px;
    }
    .step-dot::before{
      content:"";
      position:absolute;
      left:50%;
      top:0.05rem;
      transform:translateX(-50%);
      width:16px;
      height:16px;
      border-radius:50%;
      background:#d4c5f5;
      box-shadow:0 0 0 2px rgba(255,255,255,0.7);
    }
    .step-dot.active::before{
      background:var(--accent);
      box-shadow:0 0 0 4px rgba(173,0,226,0.28);
    }

    .step-panel{display:none;}
    .step-panel.active{display:block;}

    .form-group{
      display:flex;
      flex-direction:column;
      gap:0.45rem;
      margin-bottom:1.0rem;
      width:100%;
    }
    .reset-box label{
      color:var(--label-light);
      font-weight:600;
      font-size:0.98rem;
    }
    body:not(.light-mode) .reset-box label{color:var(--label-dark);}

    .input-wrap{
      position:relative;
      width:100%;
      display:flex;
      align-items:center;
    }
    .reset-box input{
      padding:0.9rem 1.0rem;
      background:var(--input-bg-light);
      border:1.5px solid var(--input-border);
      color:#222;
      border-radius:14px;
      font-size:0.98rem;
      outline:none;
      width:100%;
      box-sizing:border-box;
      box-shadow:inset 0 1px 3px rgba(132,93,196,0.18);
    }
    body:not(.light-mode) .reset-box input{
      background:var(--input-bg-dark);
      color:#fff;
      box-shadow:inset 0 1px 3px rgba(0,0,0,0.18);
    }
    .reset-box input::placeholder{
      color:rgba(87,66,120,0.55);
    }
    body:not(.light-mode) .reset-box input::placeholder{
      color:rgba(245,235,255,0.65);
    }
    .reset-box input:focus{
      border-color:var(--accent);
      background:#fff;
      box-shadow:0 0 0 1px rgba(173,0,226,0.35),0 6px 18px rgba(0,0,0,0.15);
    }
    body:not(.light-mode) .reset-box input:focus{
      background:rgba(255,255,255,0.17);
    }

    .primary-btn{
      background:var(--btn-gradient);
      color:#fff;
      font-size:1.0rem;
      font-weight:700;
      border:none;
      border-radius:18px;
      padding:0.82rem 0;
      cursor:pointer;
      box-shadow:0 4px 20px rgba(173,0,226,0.13);
      letter-spacing:0.14px;
      width:100%;
      align-self:stretch;
      margin-top:0.45rem;
      margin-bottom:0.35rem;
      transition:transform .13s, box-shadow .17s, background .15s, opacity .1s;
    }
    .primary-btn:hover:not(.loading){
      background:var(--btn-gradient-hover);
      transform:translateY(-2px) scale(1.02);
      box-shadow:0 10px 40px rgba(173,0,226,0.17);
    }
    .primary-btn.loading{
      opacity:0.7;
      cursor:default;
      transform:none;
      box-shadow:none;
    }
    /* ‚Äúcooldown‚Äù after send code to avoid spam */
    .primary-btn.cooldown{
      opacity:0.6;
      cursor:default;
    }

    .eye-btn{
      position:absolute;
      right:0.9rem;
      top:50%;
      transform:translateY(-50%);
      background:none;
      border:none;
      cursor:pointer;
      color:#b290dd;
      padding:0;
      width:26px;height:26px;
      display:flex;align-items:center;justify-content:center;
    }
    .eye-btn svg{width:21px;height:21px;pointer-events:none;}

    .bottom-links{
      display:flex;
      justify-content:center;
      gap:0.5rem;
      flex-wrap:wrap;
      font-size:0.9rem;
      margin-top:0.4rem;
    }
    .bottom-links a,
    .bottom-links button{
      color:var(--accent);
      background:none;
      border:none;
      padding:0;
      cursor:pointer;
      font-weight:500;
    }
    .bottom-links button.cooldown{
      opacity:.6;
      cursor:default;
    }
    .bottom-links button.loading{
      opacity:.7;
      cursor:default;
    }
    .timer-text{font-size:0.84rem;color:#7a5ab3;}

    /* modal */
    .msg-modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.35);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:999;
    }
    .msg-modal-content{
      background:#fff;
      border-radius:18px;
      padding:1.5rem 1.9rem 1.2rem;
      max-width:360px;
      width:88vw;
      box-shadow:0 10px 35px rgba(0,0,0,0.28);
      text-align:center;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
    }
    .msg-modal-content p{
      margin:0 0 1.1rem 0;
      color:#4a2f78;
      font-size:0.96rem;
      line-height:1.45;
    }
    .msg-modal-content button{
      padding:0.45rem 1.35rem;
      border-radius:999px;
      border:none;
      font-weight:600;
      background:var(--btn-gradient);
      color:#fff;
      cursor:pointer;
      font-size:0.95rem;
      box-shadow:0 4px 18px rgba(173,0,226,0.35);
    }

    @media (max-width:540px){
      body{
        padding:3rem 0.7rem 1.9rem;
      }
      .reset-box{
        width:95vw;
        padding:1.5rem 1.1rem 1rem;
        border-radius:22px;
      }
      .brand-text{font-size:1.9rem;}
      .reset-box h2{font-size:1.18rem;}
      .reset-box p{font-size:0.9rem;}
      .mode-toggle{
        right:6px;top:7px;
        padding:5px 12px 5px 8px;
        font-size:0.95rem;
      }
      .steps-indicator{
        gap:1.6rem;
        margin-bottom:1.2rem;
      }
    }
    @media (max-width:380px){
      body{
        padding:2.6rem 0.4rem 1.4rem;
      }
      .reset-box{
        width:98vw;
        padding:1.0rem 0.7rem 0.8rem;
      }
      .brand-text{font-size:1.6rem;}
      .reset-box h2{font-size:1.05rem;}
      .mode-toggle{font-size:0.82rem;}
      .steps-indicator{
        gap:1.2rem;
      }
    }
    /* Dark-mode styling for reset modal */
body:not(.light-mode) .msg-modal {
  background: rgba(0, 0, 0, 0.55);
}

body:not(.light-mode) .msg-modal-content {
  background: rgba(28, 13, 44, 0.96);
  border: 1px solid rgba(255, 255, 255, 0.12);
  box-shadow: 0 14px 40px rgba(0, 0, 0, 0.7);
}

body:not(.light-mode) .msg-modal-content p {
  color: #f2e7ff;
}

body:not(.light-mode) .msg-modal-content button {
  background: var(--btn-gradient-hover);
  box-shadow: 0 6px 22px rgba(0, 0, 0, 0.6);
}

  </style>
</head>
<body class="light-mode">
  <!-- Dark / Light toggle -->
  <div class="mode-toggle" onclick="toggleMode()" title="Toggle dark/light mode">
    <input type="checkbox" id="modeSwitch" checked>
    <span id="modeIcon">‚òÄÔ∏è</span>
    <span id="modeText">Light Mode</span>
  </div>

  <div class="reset-box">
    <div class="brand-heading">
      <span class="brand-text">Palette and Fit</span>
    </div>

    <h2>Reset your password</h2>
    <p>Follow the steps to get a verification code and set a new password.</p>

    <!-- Step indicator -->
    <div class="steps-indicator">
      <div class="step-dot" data-step="1">Email</div>
      <div class="step-dot" data-step="2">Code</div>
      <div class="step-dot" data-step="3">New password</div>
    </div>

    <!-- STEP 1: email -->
    <div class="step-panel active" id="step1">
      <div class="form-group">
        <label for="resetEmail">Email address</label>
        <input type="email" id="resetEmail" placeholder="you@example.com" required>
      </div>
      <button class="primary-btn" id="sendCodeBtn">Send code</button>
    </div>

    <!-- STEP 2: verification code -->
    <div class="step-panel" id="step2">
      <div class="form-group">
        <label for="resetCode">Verification code</label>
        <input type="text" id="resetCode" maxlength="6" inputmode="numeric" placeholder="Enter 6-digit code">
      </div>
      <div class="bottom-links" style="margin-top:0;">
        <button type="button" id="resendBtn">Resend code</button>
        <span id="timerText" class="timer-text"></span>
      </div>
      <button class="primary-btn" id="verifyCodeBtn">Verify code</button>
    </div>

    <!-- STEP 3: new password -->
    <div class="step-panel" id="step3">
      <div class="form-group">
        <label for="pw1">Your new password</label>
        <div class="input-wrap">
          <input type="password" id="pw1" placeholder="New password">
          <button type="button" class="eye-btn" data-target="pw1">
            <svg viewBox="0 0 24 24" fill="none" stroke="#b290dd" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
              <ellipse cx="12" cy="12" rx="7.5" ry="5.2"/>
              <circle cx="12" cy="12" r="2.2"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="form-group">
        <label for="pw2">Confirm password</label>
        <div class="input-wrap">
          <input type="password" id="pw2" placeholder="Confirm password">
          <button type="button" class="eye-btn" data-target="pw2">
            <svg viewBox="0 0 24 24" fill="none" stroke="#b290dd" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round">
              <ellipse cx="12" cy="12" rx="7.5" ry="5.2"/>
              <circle cx="12" cy="12" r="2.2"/>
            </svg>
          </button>
        </div>
      </div>
      <button class="primary-btn" id="confirmPwBtn">Confirm</button>
    </div>

    <div class="bottom-links">
      <a href="login.html">Back to Login</a>
    </div>
  </div>

  <!-- Modal -->
  <div class="msg-modal" id="msgModal">
    <div class="msg-modal-content">
      <p id="msgModalText">Message here</p>
      <button id="msgModalBtn">OK</button>
    </div>
  </div>

<script>
  // Backend base URL (Render)
  const API_BASE = "https://palette-and-fit-backend.onrender.com";

  const REQUEST_ENDPOINT = API_BASE + '/api/request-password-reset';
  const VERIFY_ENDPOINT  = API_BASE + '/api/verify-reset-code';
  const RESET_ENDPOINT   = API_BASE + '/api/reset-password';

  // --- Mode ---
  function toggleMode(){
    document.body.classList.toggle('light-mode');
    const icon=document.getElementById('modeIcon');
    const txt=document.getElementById('modeText');
    const chk=document.getElementById('modeSwitch');
    if(document.body.classList.contains('light-mode')){
      icon.textContent='‚òÄÔ∏è'; txt.textContent='Light Mode'; chk.checked=true;
    }else{
      icon.textContent='üåô'; txt.textContent='Dark Mode'; chk.checked=false;
    }
  }

  function getQueryParam(name){
    const params=new URLSearchParams(window.location.search);
    return params.get(name);
  }

  // --- Modal helpers ---
  const modal=document.getElementById('msgModal');
  const modalText=document.getElementById('msgModalText');
  const modalBtn=document.getElementById('msgModalBtn');
  function showModal(msg, cb){
    modalText.textContent=msg;
    modal.style.display='flex';
    modalBtn.onclick=function(){
      modal.style.display='none';
      if(cb) cb();
    }
  }
  modal.addEventListener('click',e=>{
    if(e.target===modal){modal.style.display='none';}
  });

  // --- Steps logic ---
  let currentStep=1;
  function setStep(step){
    currentStep=step;
    document.querySelectorAll('.step-panel').forEach(p=>{
      p.classList.toggle('active', p.id===`step${step}`);
    });
    document.querySelectorAll('.step-dot').forEach(dot=>{
      dot.classList.toggle('active', parseInt(dot.dataset.step)<=step);
    });
  }

  // --- Button loading helper ---
  function setLoading(btn, isLoading, textWhileLoading){
    if(!btn) return;
    if(isLoading){
      if(!btn.dataset.originalText){
        btn.dataset.originalText = btn.textContent;
      }
      if(textWhileLoading){
        btn.textContent = textWhileLoading;
      }
      btn.classList.add('loading');
      btn.disabled = true;
    }else{
      if(btn.dataset.originalText){
        btn.textContent = btn.dataset.originalText;
      }
      btn.classList.remove('loading');
      btn.disabled = false;
    }
  }

  // --- timer for resend ---
  let timerInterval=null;
  let remainingSeconds=0;
  const timerText=document.getElementById('timerText');
  const resendBtn=document.getElementById('resendBtn');
  const sendCodeBtn=document.getElementById('sendCodeBtn');

  function startTimer(sec){
    remainingSeconds=sec;
    updateTimer();
    resendBtn.classList.add('cooldown');
    sendCodeBtn.classList.add('cooldown');
    resendBtn.disabled = true;
    sendCodeBtn.disabled = true;
    if(timerInterval) clearInterval(timerInterval);
    timerInterval=setInterval(()=>{
      remainingSeconds--;
      updateTimer();
      if(remainingSeconds<=0){
        clearInterval(timerInterval);
        timerInterval=null;
        timerText.textContent='';
        resendBtn.classList.remove('cooldown','loading');
        sendCodeBtn.classList.remove('cooldown','loading');
        resendBtn.disabled = false;
        sendCodeBtn.disabled = false;
        setLoading(resendBtn,false);
        setLoading(sendCodeBtn,false);
      }
    },1000);
  }
  function updateTimer(){
    timerText.textContent=remainingSeconds>0
      ? `Resend available in ${remainingSeconds}s`
      : '';
  }

  // --- API helpers ---
  const emailInput=document.getElementById('resetEmail');
  const codeInput=document.getElementById('resetCode');
  const pw1=document.getElementById('pw1');
  const pw2=document.getElementById('pw2');

  // STEP 1 + RESEND (uses same function with flag)
  async function sendCode(isResend=false){
    const email=emailInput.value.trim();
    if(!email){
      showModal('Please enter your email.');
      return;
    }

    const btn = isResend ? resendBtn : sendCodeBtn;

    if(btn.classList.contains('cooldown') || btn.disabled){
      return;
    }

    setLoading(btn,true,isResend ? 'Resending‚Ä¶' : 'Sending‚Ä¶');

    try{
      const res=await fetch(REQUEST_ENDPOINT,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({email})
      });
      const data=await res.json().catch(()=>({}));

      if(res.ok && data.success){
        showModal(data.message || (isResend ? 'New code sent to your email.' : 'Verification code sent to your email.'));
        setStep(2);
        startTimer(60);
      }else{
        showModal(data.message || 'Could not send code. Please try again.');
      }
    }catch(err){
      showModal('Error connecting to server. Please try again.');
    }finally{
      if(!timerInterval){
        setLoading(btn,false);
      }
    }
  }

  // STEP 2: verify
  async function verifyCode(){
    const email=emailInput.value.trim();
    const code=codeInput.value.trim();
    if(!email || !code){
      showModal('Please enter your email and the 6-digit code.');
      return;
    }

    const btn = document.getElementById('verifyCodeBtn');
    if(btn.disabled) return;
    setLoading(btn,true,'Verifying‚Ä¶');

    try{
      const payload = {email, code};

      const res=await fetch(VERIFY_ENDPOINT,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(payload)
      });
      const data=await res.json().catch(()=>({}));

      if(res.ok && data.success){
        showModal(data.message || 'Code verified.', ()=> setStep(3));
      }else{
        showModal(data.message || 'Code is incorrect or expired.');
      }
    }catch(err){
      showModal('Error connecting to server. Please try again.');
    }finally{
      setLoading(btn,false);
    }
  }

  // STEP 3: confirm new password
  async function confirmPassword(){
    const email=emailInput.value.trim();
    const code=codeInput.value.trim();
    const p1=pw1.value.trim();
    const p2=pw2.value.trim();

    if(!email || !code){
      showModal('Email and code are required.');
      setStep(2);
      return;
    }
    if(p1.length<6){
      showModal('Password must be at least 6 characters.');
      return;
    }
    if(p1!==p2){
      showModal('Passwords do not match.');
      return;
    }

    const btn = document.getElementById('confirmPwBtn');
    if(btn.disabled) return;
    setLoading(btn,true,'Updating‚Ä¶');

    try{
      const payload = {email, code, password:p1};

      const res=await fetch(RESET_ENDPOINT,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(payload)
      });
      const data=await res.json().catch(()=>({}));

      if(res.ok && data.success){
        showModal(data.message || 'Password reset successful!', ()=>{
          window.location.href='login.html';
        });
      }else{
        showModal(data.message || 'Reset failed. Please try again.');
      }
    }catch(err){
      showModal('Error connecting to server. Please try again.');
    }finally{
      setLoading(btn,false);
    }
  }

  // --- events ---
  sendCodeBtn.addEventListener('click', ()=> sendCode(false));
  resendBtn.addEventListener('click',()=>{
    if(!resendBtn.classList.contains('cooldown') && !resendBtn.disabled){
      sendCode(true);
    }
  });
  document.getElementById('verifyCodeBtn').addEventListener('click',verifyCode);
  document.getElementById('confirmPwBtn').addEventListener('click',confirmPassword);

  // password eyes
  document.querySelectorAll('.eye-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const id=btn.dataset.target;
      const input=document.getElementById(id);
      const svg=btn.querySelector('svg');
      const isPw=input.type==='password';
      input.type=isPw?'text':'password';
      svg.setAttribute('stroke',isPw?'#ad00e2':'#b290dd');
    });
  });

  // on load
  window.addEventListener('load',()=>{
    const icon=document.getElementById('modeIcon');
    const txt=document.getElementById('modeText');
    const chk=document.getElementById('modeSwitch');
    if(document.body.classList.contains('light-mode')){
      icon.textContent='‚òÄÔ∏è'; txt.textContent='Light Mode'; chk.checked=true;
    }else{
      icon.textContent='üåô'; txt.textContent='Dark Mode'; chk.checked=false;
    }
    const emailFromLink=getQueryParam('email');
    if(emailFromLink){emailInput.value=emailFromLink;}
    setStep(1);
  });
</script>
</body>
</html>
